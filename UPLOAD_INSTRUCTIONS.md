# 微信小程序上传指南 v0.0.8

## 📋 上传前检查清单

### ✅ 已完成的准备工作

1. **代码质量**
   - [x] 环境配置已切换至生产环境 (`currentEnv = 'prod'`)
   - [x] API域名已更新为线上环境 (https://wx.shubai01.com)
   - [x] Logger已配置为生产模式（仅输出错误日志）
   - [x] app.json 权限声明已修正

2. **API测试**
   - [x] 创建小凡看见 API 测试通过 ✅
   - [x] 获取期次用户 API 测试通过 ✅
   - [x] 外部API文档已更新为生产环境

3. **代码提交**
   - [x] v0.0.8 版本代码已提交
   - [x] EXTERNAL_API_GUIDE.md 已更新
   - [x] 所有改动已推送到 GitHub

4. **配置确认**
   - 项目名称: `morning-reading-miniapp`
   - AppID: `wx2b9a3c1d5e4195f8` (生产环境)
   - 库版本: `3.11.1`
   - 最小库版本: Android 7.0, iOS 11.0

---

## 🚀 上传步骤

### 步骤 1: 在微信开发工具中打开项目

1. 启动微信开发者工具
2. 点击 **"打开"**
3. 选择项目路径: `/Users/pica_1/我的坚果云/flylion/AI项目开发/七个习惯晨读营`
4. 确保项目加载成功，没有编译错误

### 步骤 2: 编译并测试

```bash
# 在微信开发工具中
1. 点击 "编译" 按钮 (快捷键: Ctrl+B / Cmd+B)
2. 等待编译完成，确保没有警告或错误
3. 在模拟器中快速测试关键功能:
   - 登录功能
   - 打卡功能
   - 小凡看见页面
   - 用户信息页面
```

### 步骤 3: 上传到体验版

```
在微信开发者工具中:
1. 点击右上角 "上传" 按钮
2. 填写版本号: 0.0.8
3. 填写项目备注/更新说明:

   本版本更新内容:
   - 修复用户信息显示问题
   - 更新为生产环境API配置
   - 优化小凡看见页面显示
   - 改进日志输出（生产环境禁用调试日志）
   - 修复权限声明配置

4. 点击 "上传" 按钮
5. 上传完成后会显示: "✅ 上传成功"
```

### 步骤 4: 设置体验版

1. 打开 [微信小程序后台](https://mp.weixin.qq.com)
2. 使用开发者账号登录
3. 进入 **"版本管理"** 页面
4. 找到刚上传的 **v0.0.8** 体验版
5. 点击 **"设为体验版"**
6. 确认设置成功

### 步骤 5: 获取体验二维码

1. 在版本管理页面，找到 v0.0.8 体验版
2. 点击 **"查看"** → 显示二维码
3. 用微信扫描二维码进行体验测试

### 步骤 6: 体验测试

通过二维码进入小程序后，测试以下功能:

```
测试清单:
- [ ] 登录功能正常
- [ ] 首页显示正确
- [ ] 打卡功能可用
- [ ] 小凡看见页面显示记录
- [ ] 用户信息页面显示正确
- [ ] 课程列表加载正常
- [ ] 没有运行时错误（F12 查看控制台）
```

---

## ✅ 提交正式版审核前检查

完成体验测试后，按以下步骤提交正式版:

### 检查清单

- [ ] 体验版已测试，功能正常
- [ ] 没有发现运行时错误
- [ ] 用户信息、打卡、小凡看见等核心功能已验证
- [ ] API 连接正常（观察网络请求）

### 提交审核

1. 微信小程序后台 → 版本管理
2. 找到 v0.0.8 体验版
3. 点击 **"提交审核"**
4. 填写审核信息:
   - 功能描述: 晨读营小程序，用户可以打卡、查看课程、与伙伴互动
   - 功能优化: 修复显示问题，优化性能
   - 其他说明: 如有相关许可/备案信息

5. 点击 **"确认提交"**

### 审核过程

- ⏳ 审核周期: 1-3 个工作日
- 📧 审核结果会通过邮件/小程序后台消息通知
- ✅ 审核通过后，点击 **"发布"** 正式上线
- ❌ 如被驳回，修改问题后可重新提交

---

## 🔧 故障排查

### 上传时遇到编译错误

**症状**: "编译失败" / "无法上传"

**解决方案**:

```bash
# 在微信开发工具中
1. 点击 工具 → 清除缓存
2. 清空所有缓存选项
3. 重新编译 (Ctrl+B)
4. 如仍有错误，检查:
   - app.json 是否有语法错误
   - 所有文件路径是否正确
   - 是否有 undefined 或空值
```

### 上传时提示 AppID 不正确

**症状**: "AppID不匹配" / "无权限上传"

**检查方法**:

```
1. 确认使用的是生产环境 AppID: wx2b9a3c1d5e4195f8
2. 微信小程序后台确认 AppID: mp.weixin.qq.com
3. 微信开发工具中 project.config.json 的 appid 字段
4. 确保已用正确的开发者账号登录
```

### 体验版中 API 返回 401/403 错误

**症状**: 登录失败，显示 "API 错误"

**检查方法**:

```
1. 确认 miniprogram/config/env.js 中:
   - currentEnv = 'prod'
   - apiBaseUrl = 'https://wx.shubai01.com/api/v1'

2. 在小程序中按 F12 打开控制台
3. 查看网络请求，确认:
   - URL 是 https://wx.shubai01.com 开头
   - 包含正确的 Authorization 头
   - 响应状态码和错误信息

4. 如问题持续，检查后端 CORS 配置
   - backend/.env.production 中的 FRONTEND_URL
```

---

## 📊 版本历史

| 版本  | 状态   | 更新内容                          |
| ----- | ------ | --------------------------------- |
| 0.0.8 | 体验版 | 修复UI布局、API环境配置、权限声明 |
| 0.0.7 | -      | 前一版本                          |

---

## 📞 联系方式

遇到问题? 检查以下资源:

1. **API 文档**: `EXTERNAL_API_GUIDE.md`
2. **开发指南**: `MINIPROGRAM_GUIDE.md`
3. **Bug 修复**: `BUG_FIXES.md`
4. **部署清单**: `.claude/memory/deployment-checklist.md`

---

**最后更新**: 2025-12-15
**准备人**: Claude Code
