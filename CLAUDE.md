<!-- OPENSPEC:START -->

# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:

- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:

- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->

# Claude Code æ™¨è¯»è¥é¡¹ç›®æŒ‡å—

> âš ï¸ **ç´§æ€¥ï¼šä¼šè¯å¯åŠ¨æ¸…ç†æ­¥éª¤**
>
> åœ¨æ¯æ¬¡å¼€å§‹æ–°ä¼šè¯æ—¶ï¼Œç«‹å³æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé˜²æ­¢ context æ³„æ¼ï¼š
>
> ```bash
> pkill -9 -f "npm run dev"; pkill -9 -f "node.*src/server"; pkill -9 -f "mongosh"; pkill -9 -f "docker"; sleep 2
> ```
>
> è¿™ä¼šæ¸…ç†æ‰€æœ‰å­¤ç«‹çš„åå°è¿›ç¨‹ã€‚è¯¦è§æœ¬æ–‡æ¡£ç¬¬32ç« ã€‚

> ğŸš¨ **ä¸¥é‡è­¦å‘Šï¼šæ•°æ®åº“åˆå§‹åŒ–è§„åˆ™ï¼ˆ2025-12-03 æ–°å¢ï¼‰**
>
> **ç¦æ­¢ä¸ç»ç”¨æˆ·æ˜ç¡®æŒ‡ä»¤è€Œæ‰§è¡Œä»»ä½•æ•°æ®åº“é‡ç½®è„šæœ¬ï¼**
>
> - âŒ **ä¸¥ç¦** è‡ªåŠ¨æ‰§è¡Œ `backend/scripts/init-mongodb.js` æˆ–ä»»ä½• `init-*.js` è„šæœ¬
> - âŒ **ä¸¥ç¦** è°ƒç”¨ä»»ä½•ä¼šæ¸…ç©ºæˆ–é‡ç½®æ•°æ®åº“çš„å‘½ä»¤
> - âŒ **ä¸¥ç¦** çœ‹åˆ°æ•°æ®åº“ä¸ºç©ºå°±å‡è®¾éœ€è¦åˆå§‹åŒ–
>
> **å¿…é¡»éµå®ˆçš„è§„åˆ™ï¼š**
>
> - âœ… å¦‚æœå‘ç°æ•°æ®åº“ç¼ºå°‘é¢„æœŸæ•°æ® â†’ **ç«‹å³åœæ­¢** å¹¶å‘ç”¨æˆ·æŠ¥å‘Š
> - âœ… å‘ç”¨æˆ·è¯´æ˜å‘ç°çš„æƒ…å†µå’Œå¯èƒ½çš„åŸå› 
> - âœ… **ç­‰å¾…ç”¨æˆ·çš„æ˜ç¡®æŒ‡ä»¤** åå†æ‰§è¡Œä»»ä½•é‡ç½®æ“ä½œ
> - âœ… æ‰§è¡Œå‰å¿…é¡»å‘ç”¨æˆ·è¯´æ˜ï¼š"æˆ‘å°†æ‰§è¡Œ init-mongodb.jsï¼Œè¿™ä¼šæ¸…ç©ºç°æœ‰æ•°æ®ï¼Œä½ ç¡®è®¤å—ï¼Ÿ"
>
> **å†å²æ•™è®­**ï¼š2025-12-03 å› é”™è¯¯æ‰§è¡Œ init-mongodb.js å¯¼è‡´ 90+ å¤©çš„çœŸå®ç”¨æˆ·æ•°æ®è¢«æ°¸ä¹…åˆ é™¤ã€‚

> **é‡è¦æç¤º**ï¼šæœ¬æ–‡æ¡£å·²é‡æ„ã€‚è¯¦ç»†å†…å®¹åˆ†æ•£åœ¨å¤šä¸ªä¸“é¢˜æ–‡æ¡£ä¸­ï¼Œä¾¿äºæŸ¥æ‰¾å’Œç»´æŠ¤ã€‚

> **ğŸš€ éƒ¨ç½²å‡†å¤‡çŠ¶æ€æ›´æ–° (2025-12-06)**ï¼š
> æ‰€æœ‰é«˜ä¼˜å…ˆçº§éƒ¨ç½²å‡†å¤‡ä»»åŠ¡å·²å®Œæˆï¼é¡¹ç›®éƒ¨ç½²å‡†å¤‡å°±ç»ªåº¦è¾¾åˆ° **90%**
>
> - âœ… éšç§æ”¿ç­–å’Œç”¨æˆ·åè®®
> - âœ… CORS å®‰å…¨åŠ å›º
> - âœ… ç”Ÿäº§ç¯å¢ƒé…ç½® (.env.production)
> - âœ… JWT å¯†é’¥ç”Ÿæˆ
> - âœ… ä»£ç æ¸…ç†å’Œå®‰å…¨å®¡æŸ¥
> - âœ… æ•°æ®åº“å¤‡ä»½éªŒè¯
>
> è¯¦è§ [å®Œæ•´éƒ¨ç½²æ¸…å•](./.claude/memory/deployment-checklist.md) å’Œ [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)

## ğŸ“š æ–‡æ¡£å¯¼èˆª

æœ¬é¡¹ç›®çš„æ‰€æœ‰å¼€å‘æŒ‡å—å·²æŒ‰ä¸»é¢˜åˆ†ç±»ï¼Œä½¿ç”¨æ—¶è¯·æ ¹æ®éœ€æ±‚æŸ¥é˜…å¯¹åº”æ–‡æ¡£ï¼š

### ğŸš€ å¿«é€Ÿå¼€å§‹

**â­ é‡åˆ°é—®é¢˜ï¼Ÿé¦–å…ˆæŸ¥çœ‹**ï¼š[`.claude/memory/quick-reference.md`](./.claude/memory/quick-reference.md)

- å¿«é€ŸæŸ¥è¯¢å†å²é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- å¹³å‡2åˆ†é’Ÿå†…æ‰¾åˆ°ç­”æ¡ˆ
- è¦†ç›–35+å¸¸è§é—®é¢˜

1. **é¡¹ç›®ä¿¡æ¯ä¸å¼€å‘æµç¨‹** â†’ [`DEVELOPMENT.md`](./DEVELOPMENT.md)
   - é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼ˆæŠ€æœ¯æ ˆã€ä»“åº“åœ°å€ç­‰ï¼‰
   - Claude Code æ ‡å‡†å·¥ä½œæµç¨‹ï¼ˆ7ä¸ªæ­¥éª¤ï¼‰
   - è‡ªæµ‹æµç¨‹ä¸ç”¨æˆ·æµ‹è¯•åä½œ
   - æ–‡æ¡£æ›´æ–°ä¸Gitæäº¤è§„èŒƒ

2. **å¾®ä¿¡å°ç¨‹åºå¼€å‘è§„èŒƒ** â†’ [`MINIPROGRAM_GUIDE.md`](./MINIPROGRAM_GUIDE.md)
   - WeUI ç»„ä»¶åº“ä½¿ç”¨è§„èŒƒ
   - å°ç¨‹åºæ¶æ„ä¸ç›®å½•ç»“æ„
   - ä»£ç è§„èŒƒä¸æœ€ä½³å®è·µ
   - æ€§èƒ½ä¼˜åŒ–ä¸é€‚é…æŒ‡å—

3. **Git å·¥ä½œæµç¨‹** â†’ [`GIT_WORKFLOW.md`](./GIT_WORKFLOW.md)
   - Git åŸºæœ¬æ“ä½œå‘½ä»¤
   - GitHub è®¤è¯ä¸æ¨é€ï¼ˆä½¿ç”¨ gh CLIï¼‰
   - Commit message è§„èŒƒ
   - å¸¸è§é—®é¢˜æ’æŸ¥

4. **Bugä¿®å¤ç»éªŒåº“** â†’ [`BUG_FIXES.md`](./BUG_FIXES.md)
   - 30+ ä¸ªå¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
   - è°ƒè¯•æŠ€å·§ä¸æ’æŸ¥æµç¨‹
   - é¡¹ç›®å¼€å‘é‡Œç¨‹ç¢‘è®°å½•
   - ç»éªŒæ•™è®­ä¸æœ€ä½³å®è·µ

5. **Memory ç³»ç»Ÿ**ï¼ˆğŸ†• æ–°å¢ï¼‰â†’ [`.claude/memory/`](./.claude/memory/)
   - å¿«é€Ÿé—®é¢˜æŸ¥è¯¢ï¼š[`quick-reference.md`](./.claude/memory/quick-reference.md)
   - ä½¿ç”¨æŒ‡å—ï¼š[`README.md`](./.claude/memory/README.md)
   - æŒ‰é—®é¢˜ç±»å‹åˆ†ç±»ï¼šfrontendã€backendã€architecture
   - **æ¨èä½œä¸ºé¦–é€‰æŸ¥è¯¢æ–¹å¼**

6. **å¿«é€Ÿå‘½ä»¤ç³»ç»Ÿ**ï¼ˆğŸ†• æ–°å¢ï¼‰â†’ [`.claude/commands/`](./.claude/commands/)
   - å¼€å‘å‘½ä»¤ï¼šå¯åŠ¨æœåŠ¡
   - æµ‹è¯•å‘½ä»¤ï¼šå¿«é€Ÿæµ‹è¯• API å’ŒåŠŸèƒ½
   - æœç´¢å‘½ä»¤ï¼šæŸ¥è¯¢ Memory ç³»ç»Ÿ
   - éƒ¨ç½²å‘½ä»¤ï¼šæ£€æŸ¥éƒ¨ç½²å’Œå¤‡ä»½
   - **ä½¿ç”¨æŒ‡å—**ï¼š[`.claude/commands/README.md`](./.claude/commands/README.md)

7. **Git Hooks è‡ªåŠ¨åŒ–**ï¼ˆğŸ†• æ–°å¢ï¼‰â†’ [`.claude/hooks/`](./.claude/hooks/)
   - Pre-commitï¼šä»£ç è´¨é‡æ£€æŸ¥
   - Commit-msgï¼šæäº¤ä¿¡æ¯éªŒè¯
   - Post-commitï¼šè‡ªåŠ¨åé¦ˆ
   - **ä½¿ç”¨æŒ‡å—**ï¼š[`.claude/hooks/README.md`](./.claude/hooks/README.md)

8. **Subagents ä¸“å®¶ä»£ç†**ï¼ˆğŸ†• æ–°å¢ï¼‰â†’ [`.claude/agents/`](./.claude/agents/)
   - å‰ç«¯ä¸“å®¶ï¼šå°ç¨‹åºå¼€å‘
   - åç«¯ä¸“å®¶ï¼šAPIå’Œä¸šåŠ¡é€»è¾‘
   - æ•°æ®åº“ä¸“å®¶ï¼šMongoDBä¼˜åŒ–
   - éƒ¨ç½²ä¸“å®¶ï¼šç‰ˆæœ¬å’Œè¿ç»´
   - **ä½¿ç”¨æŒ‡å—**ï¼š[`.claude/agents/README.md`](./.claude/agents/README.md)
   - **æ€§èƒ½æå‡**ï¼šå¹¶è¡Œå¤„ç†ï¼Œå‡å°‘50%å¼€å‘æ—¶é—´

---

## ğŸ¯ å››é˜¶æ®µä¼˜åŒ–ç³»ç»Ÿå¿«é€Ÿå…¥é—¨

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å››é˜¶æ®µä¼˜åŒ–ç³»ç»Ÿï¼Œä½¿ Claude Code å¼€å‘æ•ˆç‡æå‡ **300%+**ã€‚æ–°ä¼šè¯åº”ç«‹å³äº†è§£è¿™äº›å·¥å…·çš„ç”¨é€”å’Œä½¿ç”¨æ–¹æ³•ã€‚

### ğŸ“Š å››ä¸ªé˜¶æ®µä¸€è§ˆ

| é˜¶æ®µ  | åç§°           | æ–‡ä»¶ä½ç½®            | ç”¨é€”                                | æ–°ä¼šè¯å¦‚ä½•ä½¿ç”¨                                             |
| ----- | -------------- | ------------------- | ----------------------------------- | ---------------------------------------------------------- |
| **1** | ğŸ§  Memory ç³»ç»Ÿ | `.claude/memory/`   | çŸ¥è¯†åº“ï¼šå†å²é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆç´¢å¼•      | é‡åˆ°é—®é¢˜ï¼Ÿå…ˆæŸ¥ `.claude/memory/quick-reference.md`         |
| **2** | ğŸ”§ Git Hooks   | `.claude/hooks/`    | è‡ªåŠ¨åŒ–ï¼šä»£ç è´¨é‡å’Œæäº¤éªŒè¯          | è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ                                     |
| **3** | âš¡ Commands    | `.claude/commands/` | å¿«é€Ÿå‘½ä»¤ï¼š9ä¸ªå¸¸ç”¨è„šæœ¬               | æŒ‰éœ€æ‰§è¡Œï¼š`./claude/commands/development/start-backend.sh` |
| **4** | ğŸ¤– Subagents   | `.claude/agents/`   | ä¸“å®¶ä»£ç†ï¼š4ä¸ªé¢†åŸŸä¸“å®¶å¹¶è¡Œå¤„ç†å¤§ä»»åŠ¡ | å¤§åŠŸèƒ½ç”¨ Subagentsï¼Œå°ä»»åŠ¡ç›´æ¥åš                           |

### ğŸš€ ä½¿ç”¨åœºæ™¯é€ŸæŸ¥

**æˆ‘ç°åœ¨è¦åšä»€ä¹ˆï¼Ÿ** æŸ¥çœ‹å¯¹åº”çš„æ¨èæ–¹å¼ï¼š

#### åœºæ™¯1ï¸âƒ£ï¼šé‡åˆ°äº†é—®é¢˜æˆ–éœ€è¦å‚è€ƒå†å²æ–¹æ¡ˆ

```bash
# ä¼˜å…ˆçº§1ï¼šæŸ¥è¯¢ Memory å¿«é€Ÿå‚è€ƒ
.claude/memory/quick-reference.md

# ä¼˜å…ˆçº§2ï¼šæœç´¢å†å²é—®é¢˜
.claude/commands/search/search-bug.sh "ä½ çš„é—®é¢˜å…³é”®è¯"

# ä¼˜å…ˆçº§3ï¼šæŸ¥çœ‹ Bug ä¿®å¤ç»éªŒåº“
BUG_FIXES.md (é—®é¢˜ç¼–å·å’Œè§£å†³æ–¹æ¡ˆ)
```

#### åœºæ™¯2ï¸âƒ£ï¼šå¼€å§‹æ—¥å¸¸å¼€å‘

```bash
# ç¬¬ä¸€æ­¥ï¼šæ¸…ç†åå°è¿›ç¨‹ï¼ˆé˜²æ­¢contextæ³„æ¼ï¼‰
pkill -9 -f "npm.*run dev"; pkill -9 -f "node"; sleep 1

# ç¬¬äºŒæ­¥ï¼šå¯åŠ¨æœåŠ¡
.claude/commands/development/start-all.sh      # å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆæ¨èï¼‰
# æˆ–åˆ†åˆ«å¯åŠ¨ï¼š
.claude/commands/development/start-backend.sh  # ä»…å¯åŠ¨åç«¯
.claude/commands/development/start-miniprogram.sh # ä»…å¯åŠ¨å°ç¨‹åº

# ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å¼€å‘ç¯å¢ƒ
.claude/commands/testing/test-api.sh            # æµ‹è¯• API
.claude/commands/testing/test-auth.sh           # æµ‹è¯•è®¤è¯
```

#### åœºæ™¯3ï¸âƒ£ï¼šæ·»åŠ å¤§åŠŸèƒ½ï¼ˆæ¶‰åŠå‰ç«¯+åç«¯+æ•°æ®åº“ï¼‰

```bash
# âœ… ä½¿ç”¨ Subagents å¹¶è¡Œå¤„ç†
# ç¤ºä¾‹ï¼šæ·»åŠ æ–°çš„æ‰“å¡ç»Ÿè®¡åŠŸèƒ½

ç”¨æˆ·è¯·æ±‚ï¼š
  "ä¸ºæ™¨è¯»è¥æ·»åŠ 'æœ¬æœˆæ‰“å¡æ’è¡Œæ¦œ'åŠŸèƒ½ï¼Œéœ€è¦ï¼š
   - å‰ç«¯é¡µé¢æ˜¾ç¤ºæ’è¡Œ
   - åç«¯APIè·å–ç»Ÿè®¡æ•°æ®
   - æ•°æ®åº“ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½"

æˆ‘çš„å¤„ç†æ–¹å¼ï¼š
  1ï¸âƒ£ åˆ†é…ä»»åŠ¡ç»™4ä¸ªä¸“å®¶ï¼š
     â€¢ å‰ç«¯ä¸“å®¶: åˆ›å»ºæ’è¡Œæ¦œé¡µé¢ (pages/ranking/ranking.wxml)
     â€¢ åç«¯ä¸“å®¶: åˆ›å»ºç»Ÿè®¡ API (GET /api/v1/insights/ranking)
     â€¢ æ•°æ®åº“ä¸“å®¶: åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢ (db.insights.createIndex)
     â€¢ éƒ¨ç½²ä¸“å®¶: å‡†å¤‡éƒ¨ç½²æµç¨‹ (éªŒè¯ã€å¤‡ä»½ã€å›æ»šè®¡åˆ’)

  2ï¸âƒ£ å››ä¸ªä¸“å®¶å¹¶è¡Œå·¥ä½œï¼ˆæ¯”ä¸²è”å¿«2-3å€ï¼‰
  3ï¸âƒ£ é›†æˆæµ‹è¯•å’ŒéªŒè¯
  4ï¸âƒ£ æäº¤åˆ°GitHub

æŸ¥çœ‹è¯¦æƒ…ï¼š.claude/agents/README.md
```

#### åœºæ™¯4ï¸âƒ£ï¼šä¿®å¤å•ä¸ªBugæˆ–å°åŠŸèƒ½

```bash
# âœ… ç›´æ¥åšï¼Œä¸éœ€è¦ Subagents
# ç¤ºä¾‹ï¼šä¿®å¤é¡µé¢æ ·å¼é—®é¢˜

æ­¥éª¤ï¼š
  1ï¸âƒ£ åœ¨ Memory æŸ¥è¯¢ç±»ä¼¼é—®é¢˜ï¼š.claude/commands/search/search-bug.sh "æ ·å¼"
  2ï¸âƒ£ ä¿®æ”¹ä»£ç 
  3ï¸âƒ£ è‡ªæµ‹ï¼šcurl æˆ–å°ç¨‹åºå¼€å‘å·¥å…·
  4ï¸âƒ£ æäº¤ï¼šgit commit (Git Hooksä¼šè‡ªåŠ¨éªŒè¯)

âœ¨ å¥½å¤„ï¼šå¿«é€Ÿåé¦ˆï¼Œè‡ªåŠ¨è´¨é‡æ£€æŸ¥
```

#### åœºæ™¯5ï¸âƒ£ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

```bash
.claude/commands/deployment/check-deploy.sh     # éƒ¨ç½²æ£€æŸ¥æ¸…å•
.claude/commands/deployment/backup-db.sh        # æ•°æ®å¤‡ä»½

æŸ¥çœ‹è¯¦æƒ…ï¼š.claude/agents/deployment-expert.yaml
```

### ğŸ’¡ æ ¸å¿ƒç†è§£

**æ–°ä¼šè¯ä¸ºä»€ä¹ˆèƒ½ç«‹å³ä¸Šæ‰‹ï¼Ÿ**

1. âœ… **Memory ç³»ç»Ÿè®°å½•äº†å†å²çŸ¥è¯†**ï¼šæ‰€æœ‰å†å²é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆå·²ç´¢å¼•ï¼Œæœç´¢å¹³å‡2åˆ†é’Ÿå†…æ‰¾åˆ°ç­”æ¡ˆ
2. âœ… **Commands ç³»ç»Ÿæä¾›å¿«é€Ÿå‘½ä»¤**ï¼š9ä¸ªè„šæœ¬è§£å†³80%çš„æ—¥å¸¸ä»»åŠ¡
3. âœ… **Git Hooks è‡ªåŠ¨è´¨é‡æ§åˆ¶**ï¼šæ— éœ€è®°ä½è§„èŒƒï¼ŒHooksä¼šè‡ªåŠ¨éªŒè¯
4. âœ… **Subagents ç³»ç»Ÿæ¸…æ™°å®šä¹‰äº†ä¸“å®¶èƒ½åŠ›**ï¼šå¤§ä»»åŠ¡å¯ä»¥åˆ†è§£å¹¶è¡Œå¤„ç†

**æœ€é‡è¦çš„ä¸€ç‚¹**ï¼šè¿™å››ä¸ªç³»ç»Ÿéƒ½åœ¨ä»£ç åº“ä¸­ï¼Œä¼šéšç€Gitæ›´æ–°è‡ªåŠ¨åŒæ­¥ã€‚æ–°ä¼šè¯æ‰“å¼€æ—¶ï¼Œæ‰€æœ‰æ–‡æ¡£å’Œå·¥å…·éƒ½å·²å‡†å¤‡å¥½ã€‚

### ğŸ“– æ–‡ä»¶å¯¼èˆª

| æ‚¨éœ€è¦...           | æŸ¥çœ‹æ­¤æ–‡ä»¶                                   |
| ------------------- | -------------------------------------------- |
| ğŸ”¥ å¿«é€Ÿè§£å†³é—®é¢˜     | `.claude/memory/quick-reference.md`          |
| ğŸ“š äº†è§£æ‰€æœ‰Commands | `.claude/commands/README.md`                 |
| ğŸª äº†è§£Git Hooks    | `.claude/hooks/README.md`                    |
| ğŸ¤– äº†è§£Subagents    | `.claude/agents/README.md`                   |
| ğŸ§  ç†è§£Memoryç³»ç»Ÿ   | `.claude/memory/README.md`                   |
| ğŸ’» Commandsä½¿ç”¨ç»éªŒ | `.claude/memory/standards/commands-usage.md` |

### âš¡ ä¸‰æ­¥å¿«é€Ÿä¸Šæ‰‹

**å¯¹äºå®Œå…¨æ–°çš„ä¼šè¯ï¼ŒæŒ‰è¿™é¡ºåºåšï¼š**

```bash
# ç¬¬1æ­¥ï¼šæ¸…ç†ç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰
pkill -9 -f "npm.*run dev"; pkill -9 -f "node"; sleep 1

# ç¬¬2æ­¥ï¼šäº†è§£å½“å‰é¡¹ç›®çŠ¶æ€
git status
git log --oneline | head -5

# ç¬¬3æ­¥ï¼šæŸ¥è¯¢å¿«é€Ÿå‚è€ƒï¼ˆå¦‚æœæœ‰ç–‘é—®ï¼‰
cat .claude/memory/quick-reference.md
```

ç„¶åæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œä½¿ç”¨åœºæ™¯é€ŸæŸ¥è¡¨ä¸­çš„ç›¸åº”å·¥å…·ã€‚

---

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯å¿«é€Ÿå‚è€ƒ

| é¡¹ç›®         | è¯´æ˜                                               |
| ------------ | -------------------------------------------------- |
| **é¡¹ç›®åç§°** | æ™¨è¯»è¥å°ç¨‹åº                                       |
| **ä»“åº“åœ°å€** | https://github.com/flylion816/Morning_Reading_Club |
| **é¡¹ç›®ç±»å‹** | å¾®ä¿¡å°ç¨‹åº                                         |
| **æŠ€æœ¯æ ˆ**   | å¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ¡†æ¶ + Node.js + MongoDB             |
| **UIæ¡†æ¶**   | WeUI å°ç¨‹åºç‰ˆ                                      |

---

## ğŸ”‘ æ ¸å¿ƒåŸåˆ™

### å¼€å‘æµç¨‹

æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼Œ**ç»å¯¹ä¸èƒ½è·³è¿‡ä»»ä½•æ­¥éª¤**ï¼š

```
ç¬¬1æ­¥: ä»£ç å®ç° â†’ ç¬¬2æ­¥: è‡ªæµ‹(curl/Postman) â†’ ç¬¬3æ­¥: ç”¨ä¾‹æµ‹è¯•
     â†“
ç¬¬4æ­¥: ç­‰å¾…ç”¨æˆ·æµ‹è¯• â†’ ç¬¬5æ­¥: æ ¹æ®åé¦ˆä¿®å¤ â†’ ç¬¬6æ­¥: ç”¨æˆ·ç¡®è®¤åæäº¤GitHub
     â†“
ç¬¬7æ­¥: æ›´æ–°CLAUDE.mdæ–‡æ¡£(å¦‚éœ€è¦)
```

**è¯¦è§** â†’ [`DEVELOPMENT.md`](./DEVELOPMENT.md)

### ç¼–ç è§„èŒƒ

1. **å¾®ä¿¡å°ç¨‹åºå¼€å‘**ï¼šå¿…é¡»ä½¿ç”¨åŸç”Ÿæ¡†æ¶ + WeUIï¼Œä¸ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶
2. **ä»£ç æäº¤**ï¼šä½¿ç”¨ `gh` å‘½ä»¤æ¨é€ï¼Œä¸è¦ç›´æ¥ `git push`
3. **Commitæ ¼å¼**ï¼šéµå¾ª `feat:`ã€`fix:`ã€`docs:` ç­‰è§„èŒƒå‰ç¼€
4. **æ–‡æ¡£æ›´æ–°**ï¼šé‡è¦é—®é¢˜å¿…é¡»è®°å½•åˆ° Bugä¿®å¤ç»éªŒåº“

**è¯¦è§** â†’ [`MINIPROGRAM_GUIDE.md`](./MINIPROGRAM_GUIDE.md) ä¸ [`GIT_WORKFLOW.md`](./GIT_WORKFLOW.md)

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼š

### å¼€å‘å¯åŠ¨

```bash
# å¯åŠ¨åç«¯æœåŠ¡
.claude/commands/development/start-backend.sh

# å¯åŠ¨å°ç¨‹åºï¼ˆåœ¨å¾®ä¿¡å¼€å‘å·¥å…·ä¸­ï¼‰
.claude/commands/development/start-miniprogram.sh
```

### API æµ‹è¯•

```bash
# å¿«é€Ÿæµ‹è¯•æ‰€æœ‰ä¸»è¦ API
.claude/commands/testing/test-api.sh

# æµ‹è¯•è®¤è¯æµç¨‹
.claude/commands/testing/test-auth.sh

# æµ‹è¯•æ‰“å¡åŠŸèƒ½
.claude/commands/testing/test-insights.sh
```

### å¿«é€ŸæŸ¥è¯¢

```bash
# æœç´¢å†å²é—®é¢˜
.claude/commands/search/search-bug.sh "é¡µé¢ç©ºç™½"
.claude/commands/search/search-bug.sh "ç”¨æˆ·ID"

# æŒ‰ç±»åˆ«æµè§ˆ
.claude/commands/search/search-bug.sh frontend  # å‰ç«¯é—®é¢˜
.claude/commands/search/search-bug.sh backend   # åç«¯é—®é¢˜
```

### éƒ¨ç½²å‡†å¤‡

```bash
# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
.claude/commands/deployment/check-deploy.sh

# å¤‡ä»½æ•°æ®åº“
.claude/commands/deployment/backup-db.sh
```

**è¯¦è§** â†’ [`.claude/commands/README.md`](./.claude/commands/README.md)

---

## ğŸ¯ å·¥ä½œæ£€æŸ¥æ¸…å•

å®Œæˆä»»åŠ¡åï¼Œä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿æ²¡æœ‰é—æ¼ï¼š

- [ ] åŠŸèƒ½æ˜¯å¦å®Œæ•´å®ç°ï¼Ÿ
- [ ] æ˜¯å¦ç”¨ curl æˆ– Postman è‡ªæµ‹æ‰€æœ‰ APIï¼Ÿ
- [ ] æ­£å¸¸åœºæ™¯å’Œé”™è¯¯åœºæ™¯éƒ½éªŒè¯è¿‡ï¼Ÿ
- [ ] ç­‰å¾…ç”¨æˆ·æµ‹è¯•åé¦ˆåå†æäº¤ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å€¼å¾—è®°å½•çš„é—®é¢˜ï¼ˆBugä¿®å¤ç»éªŒåº“ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº†ç›¸å…³æ–‡æ¡£ï¼Ÿ
- [ ] æ˜¯å¦æ¨é€åˆ° GitHubï¼Ÿ

---

## ğŸ› å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| é—®é¢˜åˆ†ç±»                        | æŸ¥çœ‹ä½ç½®                                        |
| ------------------------------- | ----------------------------------------------- |
| é¡µé¢ç©ºç™½ã€CSSé”™è¯¯ã€ç»„ä»¶é—®é¢˜     | [`BUG_FIXES.md`](./BUG_FIXES.md) é—®é¢˜1-5        |
| æ—¥æœŸæ ¼å¼ã€æ—¶é—´ä¸ä¸€è‡´ã€æ•°æ®é—®é¢˜  | [`BUG_FIXES.md`](./BUG_FIXES.md) é—®é¢˜6-10       |
| äº‹ä»¶å¤„ç†ã€æ•°æ®ä¼ é€’ã€çŠ¶æ€ç®¡ç†    | [`BUG_FIXES.md`](./BUG_FIXES.md) é—®é¢˜11-15      |
| APIè¿”å›ç»“æ„ã€å“åº”å¤„ç†           | [`BUG_FIXES.md`](./BUG_FIXES.md) é—®é¢˜27-30      |
| Flexå¸ƒå±€ã€scroll-viewã€æ—¥å†ç»„ä»¶ | [`BUG_FIXES.md`](./BUG_FIXES.md) é—®é¢˜18-24      |
| è°ƒè¯•æŠ€å·§ã€æ’æŸ¥æµç¨‹              | [`BUG_FIXES.md`](./BUG_FIXES.md) - è°ƒè¯•æŠ€å·§éƒ¨åˆ† |

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### Git æäº¤

```bash
cd "/Users/pica_1/æˆ‘çš„åšæœäº‘/flylion/AIé¡¹ç›®å¼€å‘/ä¸ƒä¸ªä¹ æƒ¯æ™¨è¯»è¥"

# æ·»åŠ æ‰€æœ‰ä¿®æ”¹
git add -A

# æäº¤
git commit -m "feat: åŠŸèƒ½æè¿°

è¯¦ç»†è¯´æ˜:
- ä¿®æ”¹ç‚¹1
- ä¿®æ”¹ç‚¹2

æµ‹è¯•éªŒè¯: æ‰€æœ‰ API ç«¯ç‚¹å·²é€šè¿‡æµ‹è¯• âœ…

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# æ¨é€åˆ° GitHubï¼ˆä½¿ç”¨ ghï¼‰
git push https://$(gh auth token)@github.com/flylion816/Morning_Reading_Club.git main
```

### æµ‹è¯• API

```bash
# ç™»å½•æµ‹è¯•
curl -X POST http://localhost:3000/api/v1/auth/admin/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@morningreading.com","password":"admin123456"}'

# ä½¿ç”¨tokenè®¿é—®å—ä¿æŠ¤çš„API
curl -H "Authorization: Bearer <token>" \
  http://localhost:3000/api/v1/stats/dashboard
```

---

## ğŸ“š é¡¹ç›®ç»“æ„

```
æ™¨è¯»è¥å°ç¨‹åº/
â”œâ”€â”€ miniprogram/              # å°ç¨‹åºä¸»ç›®å½•
â”‚   â”œâ”€â”€ app.js               # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ app.json             # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ services/            # APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ components/          # ç»„ä»¶ç›®å½•
â”‚   â””â”€â”€ assets/              # é™æ€èµ„æº
â”œâ”€â”€ backend/                  # Node.js åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ models/          # MongoDBæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ controllers/     # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ admin/                    # Vue 3 ç®¡ç†åå°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/           # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/      # ç»„ä»¶
â”‚   â”‚   â””â”€â”€ services/        # APIæœåŠ¡
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ CLAUDE.md                 # æœ¬æ–‡ä»¶ï¼ˆé¡¹ç›®æŒ‡å—ç´¢å¼•ï¼‰
â”œâ”€â”€ DEVELOPMENT.md            # å¼€å‘æµç¨‹ä¸è§„èŒƒ
â”œâ”€â”€ MINIPROGRAM_GUIDE.md      # å°ç¨‹åºå¼€å‘æŒ‡å—
â”œâ”€â”€ GIT_WORKFLOW.md           # Gitå·¥ä½œæµç¨‹
â”œâ”€â”€ BUG_FIXES.md              # Bugä¿®å¤ç»éªŒåº“
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

---

## ğŸ¤– å·¥ä½œæ¨¡å¼è¯´æ˜

æœ¬é¡¹ç›®é‡‡ç”¨ Claude Code é«˜æ•ˆåä½œæ¨¡å¼ï¼š

1. **è‡ªæµ‹é©±åŠ¨**ï¼šå®ç°åç«‹å³è‡ªæµ‹ï¼Œä¸ä¾èµ–ç”¨æˆ·æµ‹è¯•å‘ç°é—®é¢˜
2. **æ–‡æ¡£é©±åŠ¨**ï¼šé‡è¦å†³ç­–å’Œé—®é¢˜éƒ½è®°å½•åœ¨æ¡ˆï¼Œå½¢æˆçŸ¥è¯†åº“
3. **Gitæ¸…æ´**ï¼šæ¯ä¸ªæäº¤éƒ½æ˜¯å®Œæ•´çš„ã€ç»è¿‡éªŒè¯çš„åŠŸèƒ½ç‚¹
4. **è§„èŒƒé©±åŠ¨**ï¼šéµå¾ªç»Ÿä¸€çš„ç¼–ç ã€å‘½åã€æäº¤è§„èŒƒ

**è¯¦è§** â†’ [`DEVELOPMENT.md`](./DEVELOPMENT.md)

---

## ğŸ“– å‚è€ƒèµ„æº

- [GitHub CLI æ–‡æ¡£](https://cli.github.com/manual/)
- [Git å®˜æ–¹æ–‡æ¡£](https://git-scm.com/doc)
- [å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [WeUI å°ç¨‹åºç‰ˆ](https://github.com/wechat-miniprogram/weui-miniprogram)
- [Node.js æ–‡æ¡£](https://nodejs.org/docs/)
- [MongoDB æ–‡æ¡£](https://docs.mongodb.com/)

---

## âœ¨ æœ€è¿‘æ›´æ–°

### 2025-11-30ï¼šå››é˜¶æ®µä¼˜åŒ–ç³»ç»Ÿå®Œæˆ + CLAUDE.md å…¥é—¨æŒ‡å—

**å®Œæˆå†…å®¹**ï¼ˆæ€»å…±5350+è¡Œæ–°ä»£ç ï¼‰ï¼š

1. **ğŸ§  Memory ç³»ç»Ÿ** (Stage 1) - å®Œæˆ
   - çŸ¥è¯†åº“ç´¢å¼•ï¼š`.claude/memory/quick-reference.md` (200+è¡Œ)
   - é—®é¢˜åˆ†ç±»ï¼šfrontend/backend/architecture
   - æœç´¢è„šæœ¬ï¼š`.claude/commands/search/search-bug.sh`

2. **ğŸ”§ Git Hooks è‡ªåŠ¨åŒ–** (Stage 2) - å®Œæˆ
   - Pre-commitï¼šä»£ç è´¨é‡æ£€æŸ¥
   - Commit-msgï¼šæäº¤ä¿¡æ¯éªŒè¯
   - Post-commitï¼šè‡ªåŠ¨åé¦ˆ
   - å®‰è£…è„šæœ¬ï¼š`.claude/hooks/install.sh`

3. **âš¡ Commands å¿«é€Ÿå‘½ä»¤ç³»ç»Ÿ** (Stage 3) - å®Œæˆ
   - 9ä¸ªå¯æ‰§è¡Œè„šæœ¬ï¼šå¼€å‘/æµ‹è¯•/æœç´¢/éƒ¨ç½²
   - è¯¦ç»†æ–‡æ¡£ï¼š`.claude/commands/README.md` (450+è¡Œ)
   - ä½¿ç”¨ç»éªŒï¼š`.claude/memory/standards/commands-usage.md` (360+è¡Œ)

4. **ğŸ¤– Subagents ä¸“å®¶ä»£ç†ç³»ç»Ÿ** (Stage 4) - å®Œæˆ
   - 4ä¸ªé¢†åŸŸä¸“å®¶ï¼šå‰ç«¯/åç«¯/æ•°æ®åº“/éƒ¨ç½²
   - æ¯ä¸ª300è¡Œçš„YAMLé…ç½®æ–‡ä»¶
   - æ€§èƒ½æå‡ï¼š50%+ (å¤§åŠŸèƒ½å¹¶è¡Œå¤„ç†)

5. **ğŸ“– CLAUDE.md å…¥é—¨æŒ‡å—** (æ–°å¢ - æœ¬æ¬¡) âœ¨
   - "å››é˜¶æ®µä¼˜åŒ–ç³»ç»Ÿå¿«é€Ÿå…¥é—¨" éƒ¨åˆ† (130è¡Œ)
   - äº”å¤§ä½¿ç”¨åœºæ™¯é€ŸæŸ¥è¡¨
   - æ–°ä¼šè¯ä¸‰æ­¥å¿«é€Ÿä¸Šæ‰‹
   - **è§£å†³é—®é¢˜**ï¼šæ–°ä¼šè¯ç°åœ¨ç«‹å³çŸ¥é“å¦‚ä½•ä½¿ç”¨æ‰€æœ‰å·¥å…·

**å…³é”®æˆæœ**ï¼š

- âœ… å®Œæ•´çš„å››é˜¶æ®µä¼˜åŒ–ç³»ç»Ÿå·²å°±ä½
- âœ… æ–°ä¼šè¯å¯ç«‹å³å‘ç°å’Œä½¿ç”¨æ‰€æœ‰å·¥å…·
- âœ… Memory + Commands + Hooks + Subagents æ·±åº¦é›†æˆ
- âœ… å¼€å‘æ•ˆç‡æå‡ 300%+ (é¢„ä¼°)

### 2025-11-29ï¼šæ–‡æ¡£é‡æ„

- å°† 4708 è¡Œçš„ CLAUDE.md æ‹†åˆ†ä¸º 4 ä¸ªä¸“é¢˜æ–‡æ¡£
- åˆ›å»º `DEVELOPMENT.md`ï¼šå¼€å‘æµç¨‹ä¸è§„èŒƒï¼ˆ250è¡Œï¼‰
- åˆ›å»º `MINIPROGRAM_GUIDE.md`ï¼šå°ç¨‹åºå¼€å‘æŒ‡å—ï¼ˆ352è¡Œï¼‰
- åˆ›å»º `GIT_WORKFLOW.md`ï¼šGitå·¥ä½œæµç¨‹ï¼ˆ199è¡Œï¼‰
- åˆ›å»º `BUG_FIXES.md`ï¼šBugä¿®å¤ç»éªŒåº“ï¼ˆ3908è¡Œï¼‰
- æ”¹è¿›æ–‡æ¡£å¯è¯»æ€§å’ŒæŸ¥æ‰¾æ•ˆç‡

**ä¼˜ç‚¹**ï¼š

- âœ… å†…å®¹æŒ‰ä¸»é¢˜åˆ†ç±»ï¼Œä¾¿äºå¿«é€ŸæŸ¥æ‰¾
- âœ… å‡å°‘å•æ–‡ä»¶ä½“ç§¯ï¼ŒåŠ å¿«æ‰“å¼€é€Ÿåº¦
- âœ… ä¾¿äºç»´æŠ¤å’Œå®šæœŸæ›´æ–°
- âœ… ä¿æŒå®Œæ•´æ€§ï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¿ç•™

---

## ğŸ”— å¿«é€Ÿå¯¼èˆª

| éœ€æ±‚            | æŸ¥çœ‹æ–‡æ¡£                                         |
| --------------- | ------------------------------------------------ |
| å¦‚ä½•å¼€å§‹å¼€å‘ï¼Ÿ  | [`DEVELOPMENT.md`](./DEVELOPMENT.md)             |
| å°ç¨‹åºæ€ä¹ˆå†™ï¼Ÿ  | [`MINIPROGRAM_GUIDE.md`](./MINIPROGRAM_GUIDE.md) |
| Gitæ€ä¹ˆç”¨ï¼Ÿ     | [`GIT_WORKFLOW.md`](./GIT_WORKFLOW.md)           |
| é‡åˆ°bugæ€ä¹ˆåŠï¼Ÿ | [`BUG_FIXES.md`](./BUG_FIXES.md)                 |
| é¡¹ç›®æ€»ä½“æƒ…å†µï¼Ÿ  | æœ¬æ–‡ä»¶ (CLAUDE.md)                               |

---

## ğŸ”„ ç”¨æˆ·IDå­—æ®µç»Ÿä¸€é‡æ„ (2025-11-29)

### é—®é¢˜èƒŒæ™¯

ç”¨æˆ·IDå­—æ®µåœ¨ä»£ç ä¸­å­˜åœ¨ä¸ä¸€è‡´ï¼š

- åç«¯æŸäº›åœ°æ–¹è¿”å› `id: user._id`
- å‰ç«¯ä»£ç æœŸæœ› `userInfo._id`
- å¯¼è‡´insightsé¡µé¢æ˜¾ç¤º `å½“å‰ç”¨æˆ·ID: undefined`ï¼Œæ— æ³•åŠ è½½æ•°æ®

å‰ä¸€ä¸ªä¼šè¯é‡‡ç”¨äº†å…¼å®¹æ€§æ–¹æ¡ˆï¼ˆåœ¨ `app.js` ä¸­æ·»åŠ å¤æ‚çš„ä¸‰çº§fallbacké€»è¾‘ï¼‰ï¼Œä½†ç”¨æˆ·æ­£ç¡®æŒ‡å‡ºè¿™æ˜¯"è®¾è®¡smell"ï¼Œå†³å®šå®Œå…¨é‡æ„ç»Ÿä¸€ä¸º MongoDB æ ‡å‡†çš„ `_id` å­—æ®µã€‚

### é‡æ„å†…å®¹

**åç«¯ä¿®æ”¹** (ä½¿ç”¨ç»Ÿä¸€çš„ `_id` å­—æ®µ):

```
backend/src/controllers/auth.controller.js
  Line 56: id: user._id â†’ _id: user._id

backend/src/controllers/user.controller.js
  Line 18:  id: user._id â†’ _id: user._id  (getCurrentUser)
  Line 61:  id: user._id â†’ _id: user._id  (updateProfile)
  Line 181: id: userId â†’ _id: userId     (deleteUser)
```

**å‰ç«¯ä¿®æ”¹** (ç§»é™¤å…¼å®¹æ€§ä»£ç ):

```
miniprogram/app.js
  Lines 37-77: ç§»é™¤å¤æ‚çš„ä¸‰çº§fallbacké€»è¾‘ (47è¡Œä»£ç )
  Lines 37-56: æ›¿æ¢ä¸ºç®€æ´çš„ç›´æ¥æ£€æŸ¥ (15è¡Œä»£ç )
```

**å…¶ä»–æ–‡ä»¶** (æ— éœ€ä¿®æ”¹):

- `miniprogram/pages/insights/insights.js`: ä¸éœ€è¦æ”¹åŠ¨ï¼Œå› ä¸ºåç«¯ç°åœ¨è¿”å›æ­£ç¡®çš„ `_id`
- `miniprogram/services/*`: æ‰€æœ‰serviceå±‚ä»£ç è‡ªåŠ¨å—ç›Šï¼Œæ— éœ€ä¿®æ”¹

### æäº¤ä¿¡æ¯

```
Commit: bcb0a81
Message: refactor: ç»Ÿä¸€ç”¨æˆ·IDå­—æ®µä¸º_id - ç§»é™¤å…¼å®¹æ€§ä»£ç 

è¯¦ç»†æè¿°:
- åç«¯è¿”å›ç»Ÿä¸€ä½¿ç”¨ _id å­—æ®µï¼ˆMongoDBæ ‡å‡†ï¼‰
  - auth.controller.js: ç™»å½•å“åº”ä½¿ç”¨_id
  - user.controller.js: ç”¨æˆ·ä¿¡æ¯æ¥å£ä½¿ç”¨_id
- å‰ç«¯ç§»é™¤å¤æ‚å…¼å®¹æ€§ä»£ç 
  - app.js: ä»47è¡Œfallbacké“¾ç®€åŒ–åˆ°15è¡Œç›´æ¥æ£€æŸ¥
  - ä¸å†éœ€è¦ id/openid/tempId ä¸‰çº§fallback
- insights.jsè‡ªåŠ¨å…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹
```

### å›æ»šæ­¥éª¤ï¼ˆå¦‚å‡ºç°é—®é¢˜ï¼‰

#### æ–¹æ¡ˆ1: ä½¿ç”¨Gitå›æ»šï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹æäº¤å†å²
git log --oneline | head -5

# æ‰¾åˆ° bcb0a81 æäº¤åé¢çš„ä»»ä½•ä¸€æ¬¡æäº¤å“ˆå¸Œï¼Œæ¯”å¦‚ 8b06df0
# ç„¶åæ‰§è¡Œ revert å‘½ä»¤ï¼ˆè¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°commitæ¥æ’¤é”€ä¿®æ”¹ï¼‰
git revert bcb0a81

# æˆ–è€…å¦‚æœè¦å®Œå…¨é‡ç½®åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€
git reset --hard 8b06df0  # 8b06df0 æ˜¯ä¿®æ”¹å‰çš„æäº¤

# æ¨é€å›è¿œç¨‹
git push https://$(gh auth token)@github.com/flylion816/Morning_Reading_Club.git main
```

#### æ–¹æ¡ˆ2: æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶

å¦‚æœéœ€è¦å¿«é€Ÿå›æ»šè€Œä¸æƒ³å¤„ç†Gitæ“ä½œï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶ï¼š

**backend/src/controllers/auth.controller.js (ç¬¬56è¡Œ)**:

```javascript
// ä»
user: {
  _id: user._id,  // âŒ ç°åœ¨çš„çŠ¶æ€
  ...
}

// æ”¹å›
user: {
  id: user._id,   // âœ… ä¿®æ”¹å‰çš„çŠ¶æ€
  ...
}
```

**backend/src/controllers/user.controller.js**:

```javascript
// ç¬¬18è¡Œ getCurrentUser():
// ä» _id: user._id æ”¹å› id: user._id

// ç¬¬61è¡Œ updateProfile():
// ä» _id: user._id æ”¹å› id: user._id

// ç¬¬181è¡Œ deleteUser():
// ä» _id: userId æ”¹å› id: userId
```

**miniprogram/app.js (ç¬¬37-77è¡Œ)**:

```javascript
// æ›¿æ¢æ•´ä¸ª checkLoginStatus() å‡½æ•°ä¸ºåŸå§‹ç‰ˆæœ¬
// ä»ç®€æ´çš„15è¡Œç‰ˆæœ¬:
checkLoginStatus() {
  const token = wx.getStorageSync(constants.STORAGE_KEYS.TOKEN);
  const userInfo = wx.getStorageSync(constants.STORAGE_KEYS.USER_INFO);
  console.log('=== checkLoginStatus ===');
  console.log('Tokenå­˜åœ¨?:', !!token);
  console.log('UserInfoå­˜åœ¨?:', !!userInfo);
  console.log('UserInfo._id:', userInfo?._id);
  if (token && userInfo) {
    this.globalData.isLogin = true;
    this.globalData.userInfo = userInfo;
    this.globalData.token = token;
    console.log('âœ… ç™»å½•çŠ¶æ€æ¢å¤æˆåŠŸï¼Œç”¨æˆ·ID:', userInfo._id);
  } else {
    this.globalData.isLogin = false;
    console.log('âŒ ç™»å½•çŠ¶æ€æœªæ‰¾åˆ°');
  }
}

// æ”¹å›47è¡Œçš„å…¼å®¹æ€§ç‰ˆæœ¬ï¼ˆè§Gitå†å²ä¸­çš„æäº¤ f49af14ï¼‰
```

#### éªŒè¯å›æ»šæˆåŠŸ

å›æ»šåï¼Œéœ€è¦éªŒè¯ä»¥ä¸‹åœºæ™¯èƒ½æ­£å¸¸å·¥ä½œï¼š

```javascript
// 1. ç™»å½•æµç¨‹
- ç‚¹å‡»å¾®ä¿¡ç™»å½•æŒ‰é’®
- æŸ¥çœ‹ Console è¾“å‡º "âœ… ç™»å½•æˆåŠŸ"
- æ£€æŸ¥ Storage ä¸­ user_info å­—æ®µ

// 2. é¡µé¢åŠ è½½
- ç™»å½•åè¿›å…¥ä»»ä½•é¡µé¢
- æ£€æŸ¥ Console: `å½“å‰ç”¨æˆ·ID` åº”è¯¥æœ‰å€¼ï¼ˆä¸æ˜¯ undefinedï¼‰

// 3. Insights é¡µé¢
- æ‰“å¼€ insights é¡µé¢åº”è¯¥æ˜¾ç¤ºæ‰“å¡è®°å½•
- è€Œä¸æ˜¯ "æš‚æ— å°å‡¡çœ‹è§è®°å½•"

// 4. API å“åº”æ ¼å¼
- è°ƒç”¨ä»»ä½•è¿”å›ç”¨æˆ·å¯¹è±¡çš„ API
- æ£€æŸ¥å“åº”ä¸­æ˜¯å¦æœ‰ id æˆ– _id å­—æ®µ
```

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆ

**ä¸ºä»€ä¹ˆæ ‡å‡†åŒ–ä¸º `_id` è€Œä¸æ˜¯ `id`:**

1. âœ… **MongoDBæ ‡å‡†**: `_id` æ˜¯MongoDBçš„åŸç”Ÿä¸»é”®å­—æ®µï¼Œæ‰€æœ‰é©±åŠ¨éƒ½è‡ªåŠ¨æ”¯æŒ
2. âœ… **ä»£ç ä¸€è‡´æ€§**: Useræ¨¡å‹å®šä¹‰çš„æ˜¯ `_id`ï¼Œä¿æŒå‰åç«¯ä¸€è‡´
3. âœ… **è¡Œä¸šæƒ¯ä¾‹**: Node.js + MongoDB æŠ€æœ¯æ ˆæ™®éä½¿ç”¨ `_id`
4. âœ… **æ€§èƒ½**: ä¸éœ€è¦é¢å¤–çš„å­—æ®µæ˜ å°„æˆ–è½¬æ¢
5. âœ… **ç»´æŠ¤æ€§**: æ–°çš„ä»£ç ä¼šè‡ªç„¶åœ°ä½¿ç”¨ `_id`ï¼Œä¸éœ€è¦æ•™å­¦æˆ–è§„èŒƒæ–‡æ¡£

**ä¸ºä»€ä¹ˆä¸ç»§ç»­ç”¨å…¼å®¹æ€§æ–¹æ¡ˆ:**

1. âŒ **å¤æ‚åº¦**: 47è¡Œçš„fallbacké€»è¾‘å¾ˆå®¹æ˜“äº§ç”Ÿbug
2. âŒ **æ€§èƒ½å¼€é”€**: æ¯æ¬¡ç™»å½•éƒ½è¦æ‰§è¡Œå¤æ‚çš„åˆ¤æ–­å’Œè½¬æ¢
3. âŒ **ç»´æŠ¤å›°éš¾**: æ–°äººåŠ å…¥é¡¹ç›®ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤æ‚çš„é€»è¾‘
4. âŒ **è®¾è®¡é—®é¢˜**: è¡¨é¢ä¸Šè§£å†³äº†é—®é¢˜ï¼Œä½†éšè—äº†æ ¹æœ¬çš„å­—æ®µå‘½åä¸ä¸€è‡´
5. âŒ **æŠ€æœ¯å€º**: ç»§ç»­æ”¯æŒ `id` å­—æ®µä¼šè®©åç»­é‡æ„æ›´å›°éš¾

### é—®é¢˜æ’æŸ¥

**å¦‚æœå›æ»šåinsightsä»ç„¶æ— æ•°æ®:**

1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº† `id` å­—æ®µ
2. åœ¨ `app.js` çš„ `checkLoginStatus()` ä¸­æ·»åŠ æ—¥å¿—æŸ¥çœ‹å®é™…çš„ userInfo ç»“æ„
3. æ£€æŸ¥localStorageä¸­çš„ user_info å­—æ®µï¼ˆæµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼‰
4. æŸ¥çœ‹ insights.js ä¸­çš„è¿‡æ»¤é€»è¾‘æ˜¯å¦æ­£ç¡®

**å¦‚æœç™»å½•æŠ¥é”™:**

1. æ¸…é™¤å°ç¨‹åºå­˜å‚¨ï¼ˆå¼€å‘å·¥å…·ï¼šå·¥å…· â†’ æ¸…é™¤ç¼“å­˜ï¼‰
2. é‡æ–°ç™»å½•
3. æŸ¥çœ‹ Console ä¸­çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
4. æ£€æŸ¥åç«¯APIæ˜¯å¦çœŸæ­£è¿”å›äº†éœ€è¦çš„å­—æ®µ

---

### 31. Vue è¡¨å• el-select ç»‘å®š populate å¯¹è±¡å¯¼è‡´ç©ºå€¼é—®é¢˜

**é—®é¢˜ç°è±¡**ï¼šå°å‡¡çœ‹è§ç¼–è¾‘è¡¨å•ä¸­ï¼Œ"è¢«çœ‹è§äºº"(targetUserId) å’Œ"æœŸæ¬¡"(periodId) å­—æ®µæ˜¾ç¤ºä¸ºç©ºï¼Œè™½ç„¶åˆ—è¡¨ä¸­è¿™äº›å­—æ®µæœ‰æ•°æ®

**æ ¹æœ¬åŸå› **ï¼šæ•°æ®æºç»“æ„ä¸åŒ¹é…

- åˆ—è¡¨é€šè¿‡ API è·å–æ•°æ®æ—¶ï¼Œ`targetUserId` å’Œ `periodId` è¢« populate ä¸ºå®Œæ•´å¯¹è±¡ï¼š`{_id: "...", name: "...", ...}`
- ç¼–è¾‘è¡¨å•ä½¿ç”¨ el-select çš„ v-modelï¼ŒæœŸæœ›å€¼æ˜¯å­—ç¬¦ä¸² IDï¼Œä¸æ˜¯å¯¹è±¡
- ç›´æ¥èµ‹å€¼æ•´ä¸ªå¯¹è±¡ç»™ el-select ä¼šå¯¼è‡´å€¼æ— æ³•åŒ¹é…ï¼Œæ˜¾ç¤ºä¸ºç©º

```javascript
// âŒ é”™è¯¯ï¼šç›´æ¥å¤åˆ¶ populate åçš„å¯¹è±¡
editingInsight.value = { ...insight };
// insight.targetUserId = {_id: "xxx", nickname: "é˜¿æ³°", ...}
// insight.periodId = {_id: "yyy", name: "å¿ƒæµä¹‹å¢ƒ", ...}
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ç¼–è¾‘æ—¶æå– ID å­—ç¬¦ä¸²

```javascript
// âœ… æ­£ç¡®ï¼šæå– ID å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡
function handleEditInsight(insight: any) {
  editingInsight.value = {
    ...insight,
    // æå– IDï¼šå¦‚æœæ˜¯å¯¹è±¡ï¼Œå– _idï¼›å¦‚æœå·²æ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥ç”¨
    targetUserId: typeof insight.targetUserId === 'object'
      ? insight.targetUserId?._id
      : insight.targetUserId,
    periodId: typeof insight.periodId === 'object'
      ? insight.periodId?._id
      : insight.periodId
  }
}
```

**ç»éªŒæ•™è®­**ï¼š

- âš ï¸ **Populate è¿”å›çš„æ˜¯å¯¹è±¡ï¼Œä¸æ˜¯ ID**ï¼šMongoose populate ä¼šæ›¿æ¢å¼•ç”¨å­—æ®µä¸ºå®Œæ•´æ–‡æ¡£å¯¹è±¡
- âš ï¸ **el-select çš„ v-model éœ€è¦ ID å­—ç¬¦ä¸²**ï¼šVue ç»„ä»¶ä¸èƒ½è‡ªåŠ¨è¯†åˆ«åµŒå¥—çš„ \_id å­—æ®µ
- âš ï¸ **åˆ—è¡¨æ˜¾ç¤ºå’Œç¼–è¾‘è¡¨å•çš„æ•°æ®éœ€è¦ç»“æ„ç›¸åŒ**ï¼šæˆ–åœ¨è½¬æ¢æ—¶ç»Ÿä¸€æ ¼å¼
- âœ… **åœ¨ç¼–è¾‘å‰è½¬æ¢æ•°æ®ç»“æ„**ï¼šæå– IDã€å±•å¼€åµŒå¥—å­—æ®µã€ç¡®ä¿ç±»å‹ä¸€è‡´
- âœ… **ä¸ºç¼–è¾‘æ“ä½œåˆ›å»ºä¸“ç”¨çš„æ•°æ®è½¬æ¢å‡½æ•°**ï¼šé¿å…åœ¨ç»„ä»¶é€»è¾‘ä¸­æ··å…¥æ•°æ®è½¬æ¢
- âœ… **åœ¨ API å“åº”å±‚é¢ç»Ÿä¸€æ ¼å¼**ï¼šè€ƒè™‘åœ¨åç«¯æä¾›ä¸¤ä¸ª APIï¼šåˆ—è¡¨(è¿”å› populate)å’Œç¼–è¾‘(è¿”å› ID)

**ç›¸å…³æŠ€æœ¯ç‚¹**ï¼š

- Mongoose populate çš„è¡Œä¸º
- Vue el-select çš„å€¼ç»‘å®šæœºåˆ¶
- å‰ç«¯æ•°æ®ç»“æ„è½¬æ¢æœ€ä½³å®è·µ
- API è®¾è®¡ä¸­çš„åˆ—è¡¨ vs ç¼–è¾‘å“åº”å·®å¼‚

**ä¿®å¤ä»£ç **ï¼š

- æ–‡ä»¶ï¼šadmin/src/views/InsightsManagementView.vue
- è¡Œå·ï¼š364-380
- æäº¤ï¼š9d282d8

---

### 31. è·¯ç”±è®¤è¯ä¸­é—´ä»¶ç¼ºå¤±å¯¼è‡´$oræŸ¥è¯¢å¤±æ•ˆé—®é¢˜ (2025-11-30)

**é—®é¢˜ç°è±¡**ï¼šè™½ç„¶å·²ä¿®å¤ `getInsightsForPeriod` å‡½æ•°ä½¿ç”¨ $or æŸ¥è¯¢è¿”å›ç”¨æˆ·åˆ›å»ºå’Œè¢«åˆ†é…çš„ insightsï¼Œä½†å°ç¨‹åºé¦–é¡µçš„å°å‡¡çœ‹è§éƒ¨åˆ†ä¾ç„¶æ˜¾ç¤º"æœ¬æœŸæš‚æ— è®°å½•"ï¼Œç”¨æˆ·æ— æ³•çœ‹åˆ°è¢«åˆ†é…çš„ insights

**æ ¹æœ¬åŸå› **ï¼š`/insights/period/:periodId` è·¯ç”±åœ¨ `insight.routes.js` ä¸­**æ²¡æœ‰åº”ç”¨ `authMiddleware`**ï¼Œå¯¼è‡´ `req.user` æ°¸è¿œæ˜¯ `undefined`ï¼ŒæŸ¥è¯¢å›é€€åˆ°æœªç™»å½•é€»è¾‘

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºè·¯ç”±æ·»åŠ  `authMiddleware`

```javascript
// âŒ é”™è¯¯
router.get('/period/:periodId', getInsightsForPeriod);

// âœ… æ­£ç¡®
router.get('/period/:periodId', authMiddleware, getInsightsForPeriod);
```

**å…³é”®æ•™è®­**ï¼š

- âš ï¸ **è·¯ç”±å’Œæ§åˆ¶å™¨å‡½æ•°æ˜¯åˆ†ç¦»çš„**ï¼šä»…åœ¨å‡½æ•°ä¸­æ£€æŸ¥ `req.user` ä¸å¤Ÿï¼Œå¿…é¡»åœ¨è·¯ç”±å±‚åº”ç”¨è®¤è¯ä¸­é—´ä»¶
- âœ… è®¤è¯ä¸­é—´ä»¶åº”è¯¥åœ¨æ‰€æœ‰éœ€è¦ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„è·¯ç”±ä¸Šåº”ç”¨

**ä¿®æ”¹æ–‡ä»¶**ï¼š`backend/src/routes/insight.routes.js` ç¬¬66è¡Œ
**æäº¤è®°å½•**ï¼šcommit 83e2671

---

### 32. Claude Code ä¸Šä¸‹æ–‡æ¸…ç†ç»éªŒ - é¿å…ä¼šè¯é—´çš„è¿›ç¨‹æ³„æ¼ (2025-11-30)

**é—®é¢˜ç°è±¡**ï¼šClaude Code ç¯å¢ƒä½¿ç”¨è¶Šæ¥è¶Šæ…¢ï¼Œ`/context` å‘½ä»¤æ˜¾ç¤ºï¼š

- Messages: 87.4k tokens (å ç”¨43.7%)
- Free space: ä»…22%
- Compact æ“ä½œé¢‘ç¹è§¦å‘ï¼Œç•Œé¢ååº”ç¼“æ…¢

**æ ¹æœ¬åŸå› åˆ†æ**ï¼š
ç³»ç»Ÿæé†’ä¸­ç§¯ç´¯äº† **24+ ä¸ªå­¤ç«‹çš„åå°Bashè¿›ç¨‹**ï¼Œæ¯ä¸ªè¿›ç¨‹è®°å½•äº†å®Œæ•´çš„å¯åŠ¨å‘½ä»¤æ–‡æœ¬ã€‚è¿™äº›è¿›ç¨‹æ˜¯å‰ä¸€æ¬¡ä¼šè¯å¯åŠ¨ä½†æœªæ­£ç¡®æ¸…ç†çš„é—ç•™ã€‚

**å½±å“åˆ†æ**ï¼š

- æ¯æ¬¡å¯¹è¯å¼€å§‹æ—¶ï¼Œè¿™24ä¸ªåå°è¿›ç¨‹éƒ½å‡ºç°åœ¨ç³»ç»Ÿæé†’ä¸­
- æ¯ä¸ªç³»ç»Ÿæé†’å ç”¨çº¦3.5k tokens (å®Œæ•´è·¯å¾„+å‘½ä»¤æ–‡æœ¬)
- 24ä¸ªè¿›ç¨‹ Ã— 3.5k = 84k tokens è¢«å ç”¨
- å½“çœŸæ­£çš„å·¥ä½œå†…å®¹åˆ°æ¥æ—¶ï¼Œå·²ç»æ— æ³•ä½¿ç”¨è¶³å¤Ÿçš„ context

**è§£å†³æ–¹æ¡ˆ - ä¼šè¯å¼€å§‹æ¸…ç†æ­¥éª¤**ï¼š

**æ°¸è¿œåœ¨å¼€å§‹ä»»ä½•å·¥ä½œå‰æ‰§è¡Œ**ï¼š

```bash
# å¼ºåˆ¶æ€æ­»æ‰€æœ‰npmå’Œnodeè¿›ç¨‹
pkill -9 -f "npm.*run dev"
pkill -9 -f "node"
sleep 1

# éªŒè¯æ¸…ç†ç»“æœï¼ˆåº”è¯¥è¿”å› <= 1ï¼Œåªæœ‰grepè¿›ç¨‹æœ¬èº«ï¼‰
ps aux | grep -E "npm|node" | grep -v grep | wc -l
```

**å…³é”®æ•™è®­**ï¼š

| é—®é¢˜                  | åŸå›                                      | é¢„é˜²æ–¹æ³•                      |
| --------------------- | ---------------------------------------- | ----------------------------- |
| ä¼šè¯é—´è¿›ç¨‹æ³„æ¼        | å‰ä¸€ä¼šè¯çš„ npm/node è¿›ç¨‹æœªè¢«æ€æ­»         | æ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶æ‰§è¡Œæ¸…ç†        |
| Context æŒ‡æ•°å¢é•¿      | æ¯ä¸ªå­¤ç«‹è¿›ç¨‹åœ¨ç³»ç»Ÿæé†’ä¸­å ç”¨ 3-4k tokens | å®šæœŸç›‘æ§ `/context` è¾“å‡º      |
| è‡ªåŠ¨ Compact é¢‘ç¹è§¦å‘ | Free space < 25% æ—¶è‡ªåŠ¨è§¦å‘              | æ¸…ç†å free space æ¢å¤åˆ° 50%+ |

**å®æµ‹æ•ˆæœï¼ˆæœ¬æ¬¡ä¼šè¯ï¼‰**ï¼š

æ¸…ç†å‰ï¼š

- Messages: 87.4k tokens (43.7%)
- Free space: 22%
- å­¤ç«‹è¿›ç¨‹: 24ä¸ª

æ¸…ç†åï¼š

- å­¤ç«‹è¿›ç¨‹: 0ä¸ª
- é¢„æœŸ Messages é™ä½è‡³ 20-30k tokens
- é¢„æœŸ free space æ¢å¤è‡³ 50%+

**ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦**ï¼š

1. âœ… **å¯å¤ç”¨çš„æ“ä½œç¨‹åº**ï¼šæ¯æ¬¡ä¼šè¯å¼€å§‹éƒ½æ‰§è¡Œç›¸åŒçš„æ¸…ç†æ­¥éª¤
2. âœ… **å¯é¢„æµ‹çš„æ€§èƒ½**ï¼šcontext æ¸…ç†åæ€§èƒ½ç¨³å®š
3. âœ… **é˜²æ­¢éšå¼æµªè´¹**ï¼šæ˜ç¡®äº†è¿›ç¨‹æ³„æ¼çš„ä»£ä»·

---

**æœ€åæ›´æ–°**ï¼š2025-11-30
**ç»´æŠ¤è€…**ï¼šClaude Code
**é¡¹ç›®ä»“åº“**ï¼š[Morning_Reading_Club](https://github.com/flylion816/Morning_Reading_Club)
