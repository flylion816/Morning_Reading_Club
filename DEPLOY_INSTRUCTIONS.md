# ğŸš€ çº¿ä¸Šéƒ¨ç½²æŒ‡å— - æ•°æ®åº“è®¿é—®å¯†ç å®‰å…¨æ›´æ–°

## ğŸ“‹ æ¦‚è¿°

æ­¤éƒ¨ç½²è„šæœ¬ç”¨äºåœ¨çº¿ä¸Šç¯å¢ƒä¸­å®‰å…¨åœ°éƒ¨ç½²æœ€æ–°çš„ä»£ç æ›´æ”¹ï¼Œç‰¹åˆ«æ˜¯ï¼š

- âœ… æ›´æ–°æ•°æ®åº“è¡¨ç»“æ„ï¼ˆæ·»åŠ  `dbAccessPassword` å­—æ®µï¼‰
- âœ… é…ç½®ç®¡ç†å‘˜å¯†ç 
- âœ… é…ç½®æ•°æ®åº“è®¿é—®äºŒæ¬¡éªŒè¯å¯†ç 
- âœ… è‡ªåŠ¨å¤‡ä»½åŸå§‹é…ç½®

---

## ğŸ“¦ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

åœ¨æ‰§è¡Œè„šæœ¬å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] å·²åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•æ­¤ä»£ç ç‰ˆæœ¬
- [ ] å·²å¤‡ä»½çº¿ä¸Šæ•°æ®åº“
- [ ] å·²å¤‡ä»½çº¿ä¸Š `.env.production` é…ç½®æ–‡ä»¶
- [ ] çº¿ä¸Šç¯å¢ƒæœ‰ Node.js å·²å®‰è£…ï¼ˆv14+ï¼‰
- [ ] æœ‰ MongoDB çš„è®¿é—®æƒé™å’Œè¿æ¥ä¿¡æ¯
- [ ] å¯ä»¥åœ¨çº¿ä¸ŠæœåŠ¡å™¨ä¸Šæ‰§è¡Œ bash è„šæœ¬

---

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ‹‰å–æœ€æ–°ä»£ç 

```bash
cd /path/to/morning_reading_club

# ç¡®ä¿åœ¨ main åˆ†æ”¯ä¸Š
git checkout main

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main
```

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ éƒ¨ç½²è„šæœ¬

**æ–¹å¼ Aï¼šå¦‚æœä»£ç å·²æ‹‰å–**

è„šæœ¬å·²åŒ…å«åœ¨ä»£ç ä¸­ï¼Œä½ç½®ï¼š

```
./deploy-db-access-password.sh
```

**æ–¹å¼ Bï¼šæ‰‹åŠ¨ä¸Šä¼ **

å¦‚æœä½¿ç”¨æ‰‹åŠ¨ä¸Šä¼ ï¼Œè¯·å°† `deploy-db-access-password.sh` æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ã€‚

### ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/morning_reading_club

# èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
chmod +x deploy-db-access-password.sh

# æ‰§è¡Œè„šæœ¬
./deploy-db-access-password.sh
```

### ç¬¬å››æ­¥ï¼šè·Ÿéšè„šæœ¬æç¤º

è„šæœ¬ä¼šé€æ­¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **æ£€æŸ¥ MongoDB è¿æ¥** - éªŒè¯æ•°æ®åº“æ˜¯å¦å¯è®¿é—®
2. **å¤‡ä»½é…ç½®æ–‡ä»¶** - åˆ›å»º `.env.production` çš„å¤‡ä»½å‰¯æœ¬
3. **æ›´æ–°ç¯å¢ƒå˜é‡** - æ·»åŠ /æ›´æ–°ä»¥ä¸‹é…ç½®ï¼š
   - `ADMIN_DEFAULT_PASSWORD` = `Km7$Px2Qw9` (ç®¡ç†å‘˜ç™»å½•å¯†ç )
   - `ADMIN_DB_ACCESS_PASSWORD` = `Jb3#Rl8Tn5` (æ•°æ®åº“è®¿é—®å¯†ç )
   - `MYSQL_PASSWORD` = `Prod_User@Secure123!` (å¦‚æœé…ç½®å­˜åœ¨)
   - `REDIS_PASSWORD` = `Prod_Redis@Secure123!` (å¦‚æœé…ç½®å­˜åœ¨)

4. **éªŒè¯é…ç½®** - æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
5. **é‡ç½®ç®¡ç†å‘˜å¯†ç ** - åœ¨ MongoDB ä¸­æ›´æ–° Admin è¡¨
6. **éªŒè¯éƒ¨ç½²** - ç¡®è®¤æ‰€æœ‰æ›´æ”¹å·²æˆåŠŸåº”ç”¨

---

## ğŸ” éƒ¨ç½²ä¸­çš„å¯†ç é…ç½®

è„šæœ¬ä¼šä½¿ç”¨ä»¥ä¸‹ç»Ÿä¸€çš„å¯†ç æ–¹æ¡ˆï¼š

| ç”¨é€”           | å¯†ç                     | è¯´æ˜                           |
| -------------- | ----------------------- | ------------------------------ |
| ç®¡ç†å‘˜ç™»å½•     | `Km7$Px2Qw9`            | ç”¨äºåå°ç®¡ç†ç³»ç»Ÿç™»å½•           |
| **æ•°æ®åº“è®¿é—®** | **`Jb3#Rl8Tn5`**        | **ç”¨äºæ•°æ®åº“ç®¡ç†åŠŸèƒ½äºŒæ¬¡éªŒè¯** |
| MySQL ç”¨æˆ·     | `Prod_User@Secure123!`  | MySQL æ•°æ®åº“ç”¨æˆ·å¯†ç            |
| Redis          | `Prod_Redis@Secure123!` | Redis ç¼“å­˜å¯†ç                  |

> **âš ï¸ é‡è¦**ï¼šè¯·å¦¥å–„ä¿ç®¡è¿™äº›å¯†ç ï¼Œå»ºè®®å­˜å‚¨åœ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿä¸­ã€‚

---

## ğŸ“Š è„šæœ¬æ‰§è¡Œç¤ºä¾‹

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  æ™¨è¯»è¥çº¿ä¸Šéƒ¨ç½² - æ•°æ®åº“è®¿é—®å¯†ç å®‰å…¨æ›´æ–°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ï¸  è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
  1. æ£€æŸ¥ MongoDB è¿æ¥
  2. å¤‡ä»½ .env.production é…ç½®æ–‡ä»¶
  3. æ›´æ–° .env.production æ–°å¢ç¯å¢ƒå˜é‡
  4. éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
  5. æ‰§è¡Œç®¡ç†å‘˜å¯†ç é‡ç½®è„šæœ¬
  6. éªŒè¯éƒ¨ç½²ç»“æœ

â„¹ï¸  æ£€æŸ¥å…ˆå†³æ¡ä»¶...
âœ… Node.js å·²å®‰è£…
âœ… MongoDB è¿æ¥æˆåŠŸ

âš ï¸  ç¡®è®¤å¼€å§‹éƒ¨ç½²ï¼Ÿ
  æ­¤æ“ä½œå°†ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œè¯·ç¡®ä¿å·²æœ‰å¤‡ä»½
è¯·è¾“å…¥ 'yes' ç¡®è®¤: yes

â„¹ï¸  å¤‡ä»½ .env.production...
âœ… å¤‡ä»½æ–‡ä»¶: /path/to/.backup/.env.production.backup.20260226_101530

â„¹ï¸  æ›´æ–° .env.production é…ç½®...
âœ… .env.production é…ç½®å·²æ›´æ–°

â„¹ï¸  éªŒè¯ .env.production æ–‡ä»¶æ ¼å¼...
âœ… .env.production æ ¼å¼éªŒè¯é€šè¿‡

â„¹ï¸  æ‰§è¡Œç®¡ç†å‘˜å¯†ç é‡ç½®è„šæœ¬...
ğŸ”— è¿æ¥ MongoDB...
âœ… MongoDB è¿æ¥æˆåŠŸ

ğŸ” æŸ¥æ‰¾ç®¡ç†å‘˜è´¦å·: admin@morningreading.com
âœ… æ‰¾åˆ°ç®¡ç†å‘˜: SuperAdmin

ğŸ” æ›´æ–°ç™»å½•å¯†ç ...
ğŸ” æ›´æ–°æ•°æ®åº“è®¿é—®å¯†ç ...
âœ… å¯†ç æ›´æ–°æˆåŠŸï¼

ğŸ“‹ ç®¡ç†å‘˜ä¿¡æ¯ï¼š
   é‚®ç®±: admin@morningreading.com
   å§“å: SuperAdmin
   è§’è‰²: superadmin
   æ–°ç™»å½•å¯†ç : Km7$Px2Qw9
   æ–°æ•°æ®åº“è®¿é—®å¯†ç : Jb3#Rl8Tn5

âœ… ç®¡ç†å‘˜å¯†ç é‡ç½®æˆåŠŸ

â„¹ï¸  éªŒè¯éƒ¨ç½²ç»“æœ...
âœ… ç¯å¢ƒå˜é‡é…ç½®éªŒè¯é€šè¿‡
âœ… éƒ¨ç½²éªŒè¯å®Œæˆ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
éƒ¨ç½²å®Œæˆæ€»ç»“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… æ‰€æœ‰æ­¥éª¤å·²æˆåŠŸå®Œæˆï¼
```

---

## âœ… éƒ¨ç½²åéªŒè¯

### 1. é‡å¯åç«¯æœåŠ¡

ä½¿ç”¨ä½ çš„éƒ¨ç½²å·¥å…·é‡å¯åç«¯æœåŠ¡ï¼ˆPM2ã€Dockerã€Systemd ç­‰ï¼‰ï¼š

```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 restart all

# æˆ–è€…é‡æ–°å¯åŠ¨ Docker å®¹å™¨
docker restart morning-reading-backend

# æˆ–è€…ä½¿ç”¨ Systemd
systemctl restart morning-reading-backend
```

### 2. éªŒè¯ç®¡ç†å‘˜ç™»å½•

```bash
curl -X POST https://wx.shubai01.com/api/v1/auth/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@morningreading.com",
    "password": "Km7$Px2Qw9"
  }'
```

**é¢„æœŸå“åº”**ï¼š

```json
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGc...",
    "admin": {
      "_id": "...",
      "email": "admin@morningreading.com",
      "name": "SuperAdmin",
      "role": "superadmin"
    }
  }
}
```

### 3. éªŒè¯æ•°æ®åº“è®¿é—®å¯†ç 

```bash
# 1. é¦–å…ˆä½¿ç”¨ä¸Šé¢è¿”å›çš„ token
TOKEN="ä»ä¸Šé¢çš„å“åº”ä¸­å¤åˆ¶ token å€¼"

# 2. éªŒè¯æ•°æ®åº“è®¿é—®å¯†ç 
curl -X POST https://wx.shubai01.com/api/v1/auth/admin/verify-db-access \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "password": "Jb3#Rl8Tn5"
  }'
```

**é¢„æœŸå“åº”**ï¼š

```json
{
  "code": 0,
  "message": "éªŒè¯æˆåŠŸ",
  "data": {
    "verified": true
  }
}
```

### 4. åœ¨ç®¡ç†åå°éªŒè¯

1. æ‰“å¼€ç®¡ç†åå°ï¼šhttps://wx.shubai01.com
2. ä½¿ç”¨æ–°å¯†ç ç™»å½•ï¼š
   - é‚®ç®±ï¼š`admin@morningreading.com`
   - å¯†ç ï¼š`Km7$Px2Qw9`
3. ç‚¹å‡»å·¦ä¾§èœå• "ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†"
4. è¾“å…¥æ•°æ®åº“è®¿é—®å¯†ç ï¼š`Jb3#Rl8Tn5`
5. éªŒè¯é€šè¿‡ååº”è·³è½¬åˆ°æ•°æ®åº“ç®¡ç†é¡µé¢

---

## ğŸ”™ ç¾éš¾æ¢å¤

### å¦‚æœéƒ¨ç½²å¤±è´¥

è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ã€‚æ¢å¤æ­¥éª¤ï¼š

```bash
# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶åˆ—è¡¨
ls -la .backup/

# æ¢å¤æœ€è¿‘çš„å¤‡ä»½
cp .backup/.env.production.backup.20260226_101530 backend/.env.production

# é‡å¯åç«¯æœåŠ¡
pm2 restart all
```

### å¦‚æœå¿˜è®°å¯†ç 

å¯ä»¥é‡æ–°è¿è¡Œè„šæœ¬ï¼ˆä¼šæç¤ºè¦æ±‚ç¡®è®¤ï¼‰ï¼Œæˆ–æ‰‹åŠ¨æ‰§è¡Œé‡ç½®è„šæœ¬ï¼š

```bash
cd backend

# é‡ç½®ç™»å½•å¯†ç å’Œæ•°æ®åº“è®¿é—®å¯†ç 
node scripts/reset-admin-password.js \
  admin@morningreading.com \
  æ–°çš„ç™»å½•å¯†ç  \
  æ–°çš„æ•°æ®åº“è®¿é—®å¯†ç 

# ä¾‹å¦‚ï¼š
node scripts/reset-admin-password.js \
  admin@morningreading.com \
  Km7$Px2Qw9 \
  Jb3#Rl8Tn5
```

---

## ğŸ“ é…ç½®æ–‡ä»¶å˜æ›´è®°å½•

éƒ¨ç½²è„šæœ¬ä¼šæ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š

| æ–‡ä»¶                      | å˜æ›´                                  | è¯´æ˜                     |
| ------------------------- | ------------------------------------- | ------------------------ |
| `backend/.env.production` | æ–°å¢ `ADMIN_DB_ACCESS_PASSWORD`       | æ•°æ®åº“è®¿é—®å¯†ç            |
| `backend/.env.production` | æ›´æ–° `MYSQL_PASSWORD`                 | MySQL ç”¨æˆ·å¯†ç ï¼ˆå¦‚å­˜åœ¨ï¼‰ |
| `backend/.env.production` | æ›´æ–° `REDIS_PASSWORD`                 | Redis å¯†ç ï¼ˆå¦‚å­˜åœ¨ï¼‰     |
| `Admin` è¡¨                | æ–°å¢ `dbAccessPassword` å­—æ®µ          | MongoDB è‡ªåŠ¨åˆ›å»º         |
| `Admin` è®°å½•              | æ›´æ–° `password` å’Œ `dbAccessPassword` | bcrypt å“ˆå¸Œå­˜å‚¨          |

---

## âš ï¸ é‡è¦æé†’

1. **å¤‡ä»½**
   - âœ… éƒ¨ç½²å‰è¯·å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
   - âœ… éƒ¨ç½²å‰è¯·å¤‡ä»½ `.env.production` æ–‡ä»¶
   - âœ… è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½

2. **å¯†ç ç®¡ç†**
   - âš ï¸ ä¸è¦åœ¨ Git ä¸­æäº¤ `.env.production`
   - âš ï¸ ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ AWS Secrets Managerï¼‰å­˜å‚¨å¯†ç 
   - âš ï¸ å®šæœŸè½®æ¢å¯†ç 
   - âš ï¸ é™åˆ¶è®¿é—®æƒé™

3. **ç›‘æ§æ—¥å¿—**
   - â„¹ï¸ éƒ¨ç½²åç›‘æ§ `logs/error.log`
   - â„¹ï¸ æŸ¥çœ‹ API å“åº”æ˜¯å¦æœ‰å¼‚å¸¸
   - â„¹ï¸ ç›‘æ§æ•°æ®åº“è¿æ¥çŠ¶æ€

4. **ç‰ˆæœ¬æ§åˆ¶**
   - âœ… ä»£ç æ›´æ”¹å·²æäº¤ï¼šcommit `f3fd3b8`
   - âœ… é…ç½®æ–‡ä»¶ä¸åº”æäº¤ï¼ˆä½¿ç”¨ .gitignoreï¼‰
   - âœ… å¤‡ä»½æ–‡ä»¶ä¹Ÿä¸åº”æäº¤

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šè„šæœ¬æ‰§è¡Œæƒé™ä¸è¶³

```bash
# è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy-db-access-password.sh

# ç„¶åé‡æ–°æ‰§è¡Œ
./deploy-db-access-password.sh
```

### é—®é¢˜ 2ï¼šMongoDB è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MongoDB æ˜¯å¦è¿è¡Œ
ps aux | grep mongod

# æµ‹è¯•è¿æ¥
mongosh "mongodb://admin:password@host:port/database"

# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
tail -f logs/error.log
```

### é—®é¢˜ 3ï¼šNode.js æ‰¾ä¸åˆ°

```bash
# æ£€æŸ¥ Node.js å®‰è£…
which node
node --version

# å¦‚æœæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Node.js
```

### é—®é¢˜ 4ï¼šæƒé™è¢«æ‹’ç»

```bash
# ç¡®ä¿æœ‰å†™å…¥æƒé™
ls -la backend/.env.production

# å¿…è¦æ—¶ä½¿ç”¨ sudoï¼ˆè°¨æ…ï¼‰
sudo ./deploy-db-access-password.sh

# æˆ–æ›´æ”¹æ‰€æœ‰è€…
chown $USER:$USER backend/.env.production
```

---

## ğŸ“§ è”ç³»æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºæ—¥å¿—
2. æ£€æŸ¥ `logs/error.log` å’Œ `logs/combined.log`
3. éªŒè¯å¤‡ä»½æ–‡ä»¶æ˜¯å¦å®Œæ•´
4. è”ç³»å¼€å‘å›¢é˜Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘æŒ‡å—](./DEVELOPMENT.md)
- [Bug ä¿®å¤ç»éªŒåº“](./BUG_FIXES.md)
- [Git å·¥ä½œæµç¨‹](./GIT_WORKFLOW.md)
- [éƒ¨ç½²æ£€æŸ¥æ¸…å•](./.claude/commands/deployment/check-deploy.sh)

---

**æœ€åæ›´æ–°**: 2026-02-26
**è„šæœ¬ç‰ˆæœ¬**: 1.0
**åº”ç”¨ç‰ˆæœ¬**: commit f3fd3b8
