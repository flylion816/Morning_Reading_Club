<!-- æ”¯ä»˜é¡µé¢ -->
<view class="page-payment">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ”¯ä»˜é¡µé¢å†…å®¹ -->
  <view wx:else class="payment-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <view class="payment-header">
      <view class="header-icon">ğŸ’³</view>
      <text class="header-title">ç¡®è®¤æ”¯ä»˜</text>
      <text class="header-subtitle">å®ŒæˆæŠ¥åã€å¼€å¯å­¦ä¹ </text>
    </view>

    <!-- è®¢å•ä¿¡æ¯å¡ç‰‡ -->
    <view class="order-card">
      <!-- è¯¾ç¨‹ä¿¡æ¯ -->
      <view class="section">
        <text class="section-title">æŠ¥åè¯¾ç¨‹</text>
        <view class="course-info">
          <text class="course-title">{{enrollmentData.periodTitle}}</text>
          <text class="course-subtitle">{{enrollmentData.startDate}} è‡³ {{enrollmentData.endDate}}</text>
        </view>
      </view>

      <!-- åˆ†éš”çº¿ -->
      <view class="divider"></view>

      <!-- é‡‘é¢ä¿¡æ¯ -->
      <view class="section">
        <view class="price-row">
          <text class="price-label">è¯¾ç¨‹è´¹ç”¨</text>
          <text class="price-value">Â¥{{paymentAmount}}</text>
        </view>
        <view class="price-row">
          <text class="price-label">ä¼˜æƒ é‡‘é¢</text>
          <text class="price-discount">-Â¥{{discountAmount}}</text>
        </view>
        <view class="divider-light"></view>
        <view class="price-row total">
          <text class="price-label">åº”ä»˜é‡‘é¢</text>
          <text class="price-total">Â¥{{finalAmount}}</text>
        </view>
      </view>

      <!-- æ”¯ä»˜è¯´æ˜ -->
      <view class="payment-tips">
        <text class="tip-icon">â„¹ï¸</text>
        <text class="tip-text">æ”¯ä»˜æˆåŠŸåï¼Œæ‚¨å¯ä»¥ç«‹å³è¿›å…¥è¯¾ç¨‹å¼€å§‹å­¦ä¹ </text>
      </view>
    </view>

    <!-- æ”¯ä»˜æ–¹å¼é€‰æ‹© -->
    <view class="payment-methods">
      <text class="methods-title">é€‰æ‹©æ”¯ä»˜æ–¹å¼</text>

      <!-- å¾®ä¿¡æ”¯ä»˜ -->
      <view class="method-item {{paymentMethod === 'wechat' ? 'active' : ''}}"
            catchtap="selectPaymentMethod"
            data-method="wechat">
        <view class="method-left">
          <view class="method-icon wechat">ğŸ’š</view>
          <view class="method-info">
            <text class="method-name">å¾®ä¿¡æ”¯ä»˜</text>
            <text class="method-desc">å¾®ä¿¡é’±åŒ…ã€é“¶è¡Œå¡ã€é›¶é’±</text>
          </view>
        </view>
        <view class="method-check {{paymentMethod === 'wechat' ? 'checked' : ''}}"></view>
      </view>

      <!-- æ¨¡æ‹Ÿæ”¯ä»˜ï¼ˆä»…å¼€å‘æµ‹è¯•ç¯å¢ƒæ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{isDevelopment}}"
            class="method-item {{paymentMethod === 'mock' ? 'active' : ''}}"
            catchtap="selectPaymentMethod"
            data-method="mock">
        <view class="method-left">
          <view class="method-icon mock">ğŸ§ª</view>
          <view class="method-info">
            <text class="method-name">æ¨¡æ‹Ÿæ”¯ä»˜ï¼ˆæµ‹è¯•ç”¨ï¼‰</text>
            <text class="method-desc">ä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼Œç‚¹å‡»å³æ”¯ä»˜</text>
          </view>
        </view>
        <view class="method-check {{paymentMethod === 'mock' ? 'checked' : ''}}"></view>
      </view>
    </view>

    <!-- æ”¯ä»˜æŒ‰é’® -->
    <view class="payment-actions">
      <button class="btn btn-secondary" catchtap="handleCancel">è¿”å›</button>
      <button class="btn btn-primary"
              catchtap="handlePayment"
              disabled="{{!paymentMethod || paying}}"
              loading="{{paying}}">
        {{paying ? 'æ”¯ä»˜ä¸­...' : 'ç¡®è®¤æ”¯ä»˜ Â¥' + finalAmount}}
      </button>
    </view>

    <!-- æ”¯ä»˜ç»“æœå¼¹çª— -->
    <view wx:if="{{showPaymentResult}}" class="modal-mask" catchtap="closeModal">
      <view class="modal-content" catchtap="preventClose">
        <view class="result-icon {{paymentResult.success ? 'success' : 'failed'}}">
          {{paymentResult.success ? 'âœ“' : 'âœ•'}}
        </view>
        <text class="result-title">{{paymentResult.title}}</text>
        <text class="result-message">{{paymentResult.message}}</text>

        <view class="modal-actions">
          <button wx:if="{{!paymentResult.success}}" class="btn btn-secondary" catchtap="closeModal">
            è¿”å›é‡è¯•
          </button>
          <button wx:if="{{paymentResult.success}}" class="btn btn-primary" catchtap="handleSuccess">
            è¿›å…¥è¯¾ç¨‹
          </button>
        </view>
      </view>
    </view>
  </view>
</view>
