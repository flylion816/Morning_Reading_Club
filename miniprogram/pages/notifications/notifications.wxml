<!--é€šçŸ¥é¡µé¢-->
<view class="notifications-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="title-section">
      <text class="title">é€šçŸ¥</text>
      <view class="badge" wx:if="{{unreadCount > 0}}">{{unreadCount}}</view>
    </view>
    <view class="header-actions" wx:if="{{notifications.length > 0 && unreadCount > 0}}">
      <text class="action-link" bindtap="handleMarkAllAsRead">å…¨éƒ¨å·²è¯»</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && notifications.length === 0}}">
    <view class="empty-icon">ðŸ“¬</view>
    <text class="empty-text">æš‚æ— é€šçŸ¥</text>
    <text class="empty-desc">ä½ çš„é€šçŸ¥ä¼šåœ¨è¿™é‡Œæ˜¾ç¤º</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading && notifications.length === 0}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç­›é€‰é€‰é¡¹å¡ -->
  <view class="tabs" wx:if="{{notifications.length > 0}}">
    <view
      class="tab-item {{activeTab === 'all' ? 'active' : ''}}"
      bindtap="handleTabChange"
      data-tab="all"
    >
      å…¨éƒ¨
    </view>
    <view
      class="tab-item {{activeTab === 'false' ? 'active' : ''}}"
      bindtap="handleTabChange"
      data-tab="false"
    >
      æœªè¯» <text class="tab-badge" wx:if="{{unreadCount > 0}}">{{unreadCount}}</text>
    </view>
    <view
      class="tab-item {{activeTab === 'true' ? 'active' : ''}}"
      bindtap="handleTabChange"
      data-tab="true"
    >
      å·²è¯»
    </view>
  </view>

  <!-- é€šçŸ¥åˆ—è¡¨ -->
  <view class="notifications-list">
    <view
      class="notification-item {{item.isRead ? 'read' : 'unread'}}"
      wx:for="{{displayedNotifications}}"
      wx:key="{{item._id}}"
      bindtap="handleNotificationTap"
      data-id="{{item._id}}"
      data-request-id="{{item.requestId}}"
    >
      <!-- æœªè¯»æŒ‡ç¤ºç¬¦ -->
      <view class="unread-indicator" wx:if="{{!item.isRead}}"></view>

      <!-- é€šçŸ¥å†…å®¹ -->
      <view class="notification-content">
        <!-- æ ‡é¢˜å’Œæ“ä½œ -->
        <view class="notification-header">
          <view class="notification-title">
            <text class="type-icon">{{getTypeIcon(item.type)}}</text>
            <text class="type-label">{{getTypeLabel(item.type)}}</text>
          </view>
          <view class="notification-actions">
            <text
              class="action-btn delete-btn"
              bindtap="handleDelete"
              data-id="{{item._id}}"
              catchtap
            >
              âœ•
            </text>
          </view>
        </view>

        <!-- é€šçŸ¥æ¶ˆæ¯ -->
        <view class="notification-message">{{item.content}}</view>

        <!-- å‘é€è€…ä¿¡æ¯ï¼ˆå¦‚æžœæœ‰ï¼‰-->
        <view class="sender-info" wx:if="{{item.data.senderName}}">
          <image
            class="sender-avatar"
            src="{{item.data.senderAvatar || '/assets/images/default-avatar.png'}}"
          ></image>
          <text class="sender-name">{{item.data.senderName}}</text>
        </view>

        <!-- æ—¶é—´å’ŒçŠ¶æ€ -->
        <view class="notification-footer">
          <text class="time">{{formatTime(item.createdAt)}}</text>
          <text class="status" wx:if="{{!item.isRead}}">æœªè¯»</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†é¡µåŠ è½½ -->
  <view class="pagination" wx:if="{{hasMore && notifications.length > 0}}">
    <button class="load-more-btn" bindtap="handleLoadMore" loading="{{loading}}">
      åŠ è½½æ›´å¤š
    </button>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šå†…å®¹ -->
  <view class="no-more" wx:if="{{!hasMore && notifications.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šé€šçŸ¥äº†</text>
  </view>
</view>

<style>
@import './notifications.wxss';
</style>
