<view class="page-course-detail">
  <!-- è¯¾ç¨‹ä¿¡æ¯å¡ç‰‡ -->
  <view class="course-header">
    <view class="course-title">{{course.title}}</view>
  </view>

  <!-- äº”å¤§å­¦ä¹ æ¨¡å— -->
  <!-- é™ä¸€é™ -->
  <view class="content-section" wx:if="{{course.meditationVisible}}">
    <view class="section-title">
      <view class="section-icon calm">é™</view>
      <text>é™ä¸€é™</text>
    </view>
    <view class="section-content">{{course.meditation}}</view>
  </view>

  <!-- é—®ä¸€é—® -->
  <view class="content-section" wx:if="{{course.questionVisible}}">
    <view class="section-title">
      <view class="section-icon question">é—®</view>
      <text>é—®ä¸€é—®</text>
    </view>
    <view class="section-content">{{course.question}}</view>
  </view>

  <!-- è¯»ä¸€è¯» -->
  <view class="content-section" wx:if="{{course.contentVisible}}">
    <view class="section-title">
      <view class="section-icon read">è¯»</view>
      <text>è¯»ä¸€è¯»</text>
    </view>
    <view class="section-content">
      <rich-text nodes="{{course.content}}"></rich-text>
    </view>
  </view>

  <!-- æƒ³ä¸€æƒ³ -->
  <view class="content-section" wx:if="{{course.reflectionVisible}}">
    <view class="section-title">
      <view class="section-icon think">æƒ³</view>
      <text>æƒ³ä¸€æƒ³</text>
    </view>
    <view class="section-content">{{course.reflection}}</view>
  </view>

  <!-- è®°ä¸€è®° -->
  <view class="content-section" wx:if="{{course.actionVisible}}">
    <view class="section-title">
      <view class="section-icon write">è®°</view>
      <text>è®°ä¸€è®°</text>
    </view>
    <view class="section-content">{{course.action}}</view>
  </view>

  <!-- æ‘˜ä¸€æ‘˜ -->
  <view class="content-section" wx:if="{{course.extractVisible}}">
    <view class="section-title">
      <view class="section-icon extract">æ‘˜</view>
      <text>æ‘˜ä¸€æ‘˜</text>
    </view>
    <view class="section-content">{{course.extract}}</view>
  </view>

  <!-- è¯´ä¸€è¯´ -->
  <view class="content-section" wx:if="{{course.sayVisible}}">
    <view class="section-title">
      <view class="section-icon share">è¯´</view>
      <text>è¯´ä¸€è¯´</text>
    </view>
    <view class="section-content">{{course.say}}</view>
  </view>

  <!-- å­¦ä¸€å­¦ -->
  <view class="content-section" wx:if="{{course.learnVisible}}">
    <view class="section-title">
      <view class="section-icon learn">å­¦</view>
      <text>å­¦ä¸€å­¦</text>
    </view>
    <view class="section-content">{{course.learn}}</view>
  </view>

  <!-- æ¯æ—¥æ‰“å¡ -->
  <view class="comments-section" wx:if="{{course.comments}}">
    <view class="comments-header">
      <view class="comments-icon">âœ…</view>
      <text class="comments-title">æ¯æ—¥æ‰“å¡</text>
      <text class="comments-count" wx:if="{{course.comments.length}}">ï¼ˆ{{course.comments.length}} æ¡ï¼‰</text>
    </view>

    <view class="comments-list">
      <view class="comment-item" wx:for="{{course.comments}}" wx:key="id" wx:if="{{item}}" >
        <view class="comment-avatar" style="background: {{item.avatarColor || '#4a90e2'}}" bindtap="handleAvatarClick" data-user-id="{{item.userId}}">
          <image wx:if="{{item.avatarUrl}}" class="avatar-image" src="{{item.avatarUrl}}" mode="aspectFill" />
          <text wx:else class="avatar-text">{{item.avatarText}}</text>
        </view>
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-user">{{item.userName}}</text>
            <text class="comment-time">{{item.createTime}}</text>
          </view>
          <view class="comment-text">{{item.content}}</view>
          <view class="comment-footer">
            <view class="comment-like" bindtap="handleLikeComment" data-id="{{item.id}}">
              <text class="like-icon {{item.isLiked ? 'liked' : ''}}">â¤ï¸</text>
              <text class="like-count">{{item.likeCount}}</text>
            </view>
            <view class="comment-reply" bindtap="handleReplyComment" data-id="{{item.id}}">
              <text class="reply-icon">ğŸ’¬</text>
              <text>å›å¤</text>
            </view>
          </view>

          <!-- å›å¤åˆ—è¡¨ -->
          <view class="replies-list" wx:if="{{item.replies && item.replies.length > 0}}">
            <view class="reply-item" wx:for="{{item.replies}}" wx:key="id" wx:for-item="reply">
              <view class="reply-left-line"></view>
              <view class="reply-main">
                <view class="reply-avatar" style="background: {{reply.avatarColor || '#7eb5f0'}}">
                  <text class="avatar-text">{{reply.avatarText}}</text>
                </view>
                <view class="reply-content">
                  <view class="reply-header">
                    <text class="reply-user">{{reply.userName}}</text>
                    <text class="reply-time">{{reply.createTime}}</text>
                  </view>
                  <view class="reply-text">{{reply.content}}</view>
                  <view class="reply-footer">
                    <view class="reply-like" bindtap="handleLikeReply" data-comment-id="{{item.id}}" data-reply-id="{{reply.id}}">
                      <text class="like-icon {{reply.isLiked ? 'liked' : ''}}">â¤ï¸</text>
                      <text class="like-count">{{reply.likeCount || 0}}</text>
                    </view>
                    <view class="reply-reply" bindtap="handleReplyToReply" data-comment-id="{{item.id}}" data-reply-id="{{reply.id}}" data-user-name="{{reply.userName}}">
                      <text class="reply-icon">ğŸ’¬</text>
                      <text>å›å¤</text>
                    </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 23å¤©æ‰“å¡æ—¥å† -->
  <view class="calendar-section">
    <view class="calendar-title">æ‰“å¡æ—¥å† ({{checkedDays}}/23å¤©)</view>
    <view class="calendar-grid">
      <view
        wx:for="{{calendar}}"
        wx:key="day"
        class="calendar-day {{item.status}}"
        bindtap="handleDayClick"
        data-day="{{item}}">
        <text class="day-number">{{item.day}}</text>
        <text class="day-status">{{item.statusText}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="fixed-buttons">
    <button class="btn-back" bindtap="handleBack">è¿”å›</button>
    <button
      class="btn-checkin {{hasUserCheckedIn ? 'disabled' : ''}}"
      bindtap="handleCheckin"
      disabled="{{hasUserCheckedIn}}">
      {{hasUserCheckedIn ? 'å·²æ‰“å¡' : 'å»æ‰“å¡'}}
    </button>
  </view>
</view>
