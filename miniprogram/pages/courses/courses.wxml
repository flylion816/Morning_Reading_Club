<!--è¯¾èŠ‚åˆ—è¡¨é¡µ-->
<view class="page-courses">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="page-header">
    <view class="header-content">
      <view class="period-name">{{periodName}}</view>
      <view class="period-date">{{periodDate}}</view>
    </view>
  </view>

  <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
  <view class="action-buttons">
    <view class="action-btn" bindtap="handleRanking">
      <view class="btn-icon">ğŸ†</view>
      <text class="btn-text">æ’è¡Œæ¦œ</text>
    </view>
    <view class="action-btn" bindtap="handleCheckinRecords">
      <view class="btn-icon">ğŸ“…</view>
      <text class="btn-text">æ‰“å¡è®°å½•</text>
    </view>
    <view class="action-btn" bindtap="handleMembers">
      <view class="btn-icon">ğŸ‘¥</view>
      <text class="btn-text">æˆå‘˜</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs-container">
    <view class="tabs">
      <view
        class="tab-item {{currentTab === 'tasks' ? 'active' : ''}}"
        bindtap="handleTabChange"
        data-tab="tasks">
        <text>ä»»åŠ¡</text>
        <view class="tab-underline" wx:if="{{currentTab === 'tasks'}}"></view>
      </view>
      <view
        class="tab-item {{currentTab === 'dynamics' ? 'active' : ''}}"
        bindtap="handleTabChange"
        data-tab="dynamics">
        <text>åŠ¨æ€</text>
        <view class="tab-underline" wx:if="{{currentTab === 'dynamics'}}"></view>
      </view>
    </view>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒº -->
  <scroll-view
    scroll-y
    class="content-scroll"
    scroll-top="{{scrollTop}}"
    scroll-with-animation>

    <!-- ä»»åŠ¡åŒºåŸŸ -->
    <view id="tasks-section" class="section-wrapper">
      <!-- è¯¾èŠ‚åˆ—è¡¨ -->
      <view class="sections-container">
        <view
          wx:for="{{sections}}"
          wx:key="id"
          class="section-card"
          bindtap="handleSectionClick"
          data-section="{{item}}">
          <!-- è¯¾èŠ‚æ ‡é¢˜ -->
          <view class="section-title">{{item.title}}</view>

          <!-- æ—¶é—´èŒƒå›´ -->
          <view class="section-time" wx:if="{{item.startTime && item.endTime}}">{{item.startTime.split('T')[0]}} è‡³ {{item.endTime.split('T')[0]}}</view>

          <!-- åº•éƒ¨ï¼šæ‰“å¡äººæ•° + æŒ‰é’® -->
          <view class="section-footer">
            <text class="checkin-info">{{item.checkinCount}}äººå·²æ‰“å¡</text>
            <view class="btn-action" catchtap="handleCheckinClick" data-section="{{item}}">
              å»æ‰“å¡
            </view>
          </view>
        </view>

        <!-- åŠ è½½ä¸­ -->
        <view wx:if="{{loading && sections.length === 0}}" class="loading-container">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{!loading && sections.length === 0}}" class="empty-state">
          <text class="empty-state-icon">ğŸ“š</text>
          <text class="empty-state-text">æš‚æ— è¯¾èŠ‚</text>
        </view>
      </view>
    </view>

    <!-- åŠ¨æ€åŒºåŸŸï¼ˆæ‰“å¡è®°å½•ï¼‰ -->
    <view id="dynamics-section" class="section-wrapper">
      <view class="all-checkins-section" wx:if="{{allCheckins.length > 0}}">
        <view class="checkins-header">
          <text class="checkins-title">æ‰€æœ‰æ‰“å¡è®°å½•</text>
          <text class="checkins-count">ï¼ˆ{{allCheckins.length}} æ¡ï¼‰</text>
        </view>

        <view class="checkins-list">
          <view class="checkin-item" wx:for="{{allCheckins}}" wx:key="id">
            <view class="checkin-avatar" style="background: {{item.avatarColor || '#4a90e2'}}" bindtap="handleAvatarClick" data-user-id="{{item.userId}}">
              <text class="avatar-text">{{item.avatarText || item.userName}}</text>
            </view>
            <view class="checkin-main">
              <view class="checkin-top">
                <text class="checkin-user">{{item.userName}}</text>
                <text class="checkin-time">{{item.createTime}}</text>
              </view>
              <view class="checkin-section-info">
                <text class="section-tag">ç¬¬{{item.sectionDay}}å¤©</text>
                <text class="section-title-text">{{item.sectionTitle}}</text>
              </view>
              <view class="checkin-content">{{item.content}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{allCheckins.length === 0}}" class="empty-state">
        <text class="empty-state-icon">ğŸ“</text>
        <text class="empty-state-text">æš‚æ— æ‰“å¡è®°å½•</text>
      </view>
    </view>
  </scroll-view>
</view>
