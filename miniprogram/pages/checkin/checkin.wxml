<view class="page-checkin">
  <!-- 课程标题 -->
  <view class="course-title">{{courseTitle}}</view>
  <view class="course-date">{{courseDate}}</view>

  <!-- 五大学习模块 -->
  <view class="content-preview" wx:if="{{!expanded}}">
    <view class="section-preview">
      <view class="section-icon">静</view>
      <text class="section-name">静一静</text>
    </view>
    <view class="section-content-short">{{meditation}}</view>
  </view>

  <!-- 展开按钮 -->
  <view class="expand-btn" bindtap="toggleExpand">
    <text>{{expanded ? '收起' : '展开所有'}}</text>
    <text class="arrow">{{expanded ? '▲' : '▼'}}</text>
  </view>

  <!-- 展开后的完整内容 -->
  <view class="full-content" wx:if="{{expanded}}">
    <!-- 静一静 -->
    <view class="content-section" wx:if="{{meditation}}">
      <view class="section-title">
        <view class="section-icon">静</view>
        <text>静一静</text>
      </view>
      <view class="section-content">{{meditation}}</view>
    </view>

    <!-- 问一问 -->
    <view class="content-section" wx:if="{{question}}">
      <view class="section-title">
        <view class="section-icon">问</view>
        <text>问一问</text>
      </view>
      <view class="section-content">{{question}}</view>
    </view>

    <!-- 读一读 -->
    <view class="content-section" wx:if="{{content}}">
      <view class="section-title">
        <view class="section-icon">读</view>
        <text>读一读</text>
      </view>
      <view class="section-content">
        <rich-text nodes="{{content}}"></rich-text>
      </view>
    </view>

    <!-- 想一想 -->
    <view class="content-section" wx:if="{{reflection}}">
      <view class="section-title">
        <view class="section-icon">想</view>
        <text>想一想</text>
      </view>
      <view class="section-content">{{reflection}}</view>
    </view>

    <!-- 记一记 -->
    <view class="content-section" wx:if="{{action}}">
      <view class="section-title">
        <view class="section-icon">记</view>
        <text>记一记 / 摘一摘 / 说一说</text>
      </view>
      <view class="section-content">{{action}}</view>
    </view>
  </view>

  <!-- 日记输入区域 -->
  <view class="diary-input-section">
    <textarea
      class="diary-textarea"
      placeholder="请输入日记内容..."
      value="{{diaryContent}}"
      bindinput="handleInput"
      maxlength="10000"
      auto-height
    />
    <view class="char-count">{{diaryContent.length}}/10000</view>

    <!-- 可见范围 -->
    <view class="visibility-section">
      <text class="visibility-label">打卡可见范围</text>
      <view class="visibility-options">
        <view
          class="visibility-option {{visibility === 'all' ? 'active' : ''}}"
          bindtap="handleVisibilityChange"
          data-value="all">
          所有人
        </view>
        <view
          class="visibility-option {{visibility === 'admin' ? 'active' : ''}}"
          bindtap="handleVisibilityChange"
          data-value="admin">
          仅管理员
        </view>
      </view>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-buttons">
    <button class="btn-cancel" bindtap="handleCancel">取消</button>
    <button class="btn-submit" bindtap="handleSubmit">每日打卡</button>
  </view>
</view>
