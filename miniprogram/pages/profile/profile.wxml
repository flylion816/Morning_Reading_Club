<!--ä¸ªäººä¸­å¿ƒé¡µé¢-->
<view class="page-profile">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card" wx:if="{{isLogin}}">
    <view class="user-avatar-wrapper">
      <text class="user-avatar-emoji">{{userInfo.avatar || 'ğŸ¦'}}</text>
    </view>
    <view class="user-nickname">{{userInfo.nickname || 'æ™¨è¯»è¥ç”¨æˆ·'}}</view>
    <view class="user-signature">{{userInfo.signature || 'å¤©å¤©å¼€å¿ƒï¼Œè§‰çŸ¥å½“ä¸‹ï¼'}}</view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="user-card login-prompt" wx:else bindtap="handleLogin">
    <view class="user-avatar-wrapper">
      <text class="user-avatar-emoji">ğŸ‘¤</text>
    </view>
    <view class="login-text">ç‚¹å‡»ç™»å½•</view>
  </view>

  <!-- æ”¶åˆ°çš„å°å‡¡çœ‹è§è¯·æ±‚åŒºåŸŸ -->
  <view class="request-section" wx:if="{{isLogin}}">
    <view class="request-header">
      <text class="request-icon">ğŸ“¬</text>
      <text class="request-title">æ”¶åˆ°çš„å°å‡¡çœ‹è§è¯·æ±‚</text>
      <view class="request-badge" wx:if="{{insightRequests.length > 0}}">
        {{insightRequests.length}}
      </view>
    </view>
    <view class="request-list">
      <view
        wx:for="{{insightRequests}}"
        wx:key="id"
        class="request-item"
        bindtap="handleRequestClick"
        data-request="{{item}}">
        <view class="request-item-left">
          <text class="request-user-emoji">{{item.userAvatar || 'ğŸ˜Š'}}</text>
          <view class="request-info">
            <text class="request-user-name">{{item.userName}}</text>
            <text class="request-time">{{item.time}}</text>
          </view>
        </view>
        <button class="request-btn" catchtap="handleApproveRequest" data-request="{{item}}">
          æˆæƒ
        </button>
      </view>
      <view class="request-empty" wx:if="{{insightRequests.length === 0}}">
        æš‚æ— è¯·æ±‚
      </view>
    </view>
  </view>

  <!-- æ€»ä½“è¿›åº¦ç»Ÿè®¡ -->
  <view class="stats-card" wx:if="{{isLogin}}" bindtap="navigateToCourses">
    <view class="card-title">ğŸ“Š æ€»ä½“è¿›åº¦ç»Ÿè®¡</view>
    <view class="stats-item">
      <text class="stats-label">å½“å‰è¿›åº¦</text>
      <text class="stats-value">{{stats.current_day}}/{{stats.total_days}}</text>
    </view>
  </view>

  <!-- å°å‡¡çœ‹è§ - æŒ‰ç« èŠ‚ -->
  <view class="insights-card" wx:if="{{isLogin}}">
    <view class="card-title">âœ¨ å°å‡¡çœ‹è§ - æŒ‰ç« èŠ‚</view>
    <view class="insights-link" bindtap="navigateToInsights">
      <view class="insights-link-title">æŸ¥çœ‹æ‰€æœ‰åé¦ˆ</view>
      <view class="insights-link-desc">ç‚¹å‡»æŸ¥çœ‹å°å‡¡å¯¹ä½ æ¯å¤©çš„ä¸ªæ€§åŒ–åé¦ˆ...</view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-spinner"></view>
  </view>
</view>
