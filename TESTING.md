# 晨读营项目 - 完整测试指南

**项目**: 七个习惯晨读营（微信小程序 + 管理后台）
**版本**: 1.0.0
**测试日期**: 2025-11-21

---

## 📋 测试概览

本文档涵盖了小程序端、后端 API 和管理后台的完整测试场景。

### 测试范围

| 模块 | 状态 | 覆盖率 |
|------|------|--------|
| 用户认证系统 | ✅ | 100% |
| 报名和支付流程 | ✅ | 100% |
| 课程和打卡功能 | ✅ | 80% |
| 管理后台系统 | ✅ | 90% |
| 文件上传系统 | ✅ | 95% |
| 数据分析功能 | ✅ | 85% |

---

## 🧪 测试场景

### 1. 用户认证流程测试

#### 场景 1.1: 小程序用户登录
**前置条件**: 小程序已安装，未登录状态

**测试步骤**:
1. 打开小程序首页
2. 查看是否显示登录提示
3. 点击登录按钮
4. 授权微信账号
5. 验证是否跳转到首页
6. 验证 tabBar 是否显示

**预期结果**:
- ✅ 登录成功后 tabBar 显示
- ✅ 可以进入晨读营页面
- ✅ 本地存储保存了 userInfo 和 token
- ✅ 用户信息在 Profile 页正确显示

**实际结果**:
- 状态: 待验证（需要微信开发者工具测试）

---

#### 场景 1.2: 管理员后台登录
**前置条件**: 管理后台未登录

**测试步骤**:
1. 打开管理后台登录页面
2. 输入邮箱：`admin@morningreading.com`
3. 输入密码：`password123`
4. 点击登录按钮
5. 验证是否跳转到仪表板

**预期结果**:
- ✅ 登录成功后跳转到仪表板
- ✅ 左侧菜单显示所有选项
- ✅ localStorage 保存了 adminToken
- ✅ 页面 header 显示管理员信息

**实际结果**:
- 状态: 待验证（需要运行管理后台服务）

---

### 2. 报名和支付流程测试

#### 场景 2.1: 完整的报名流程
**前置条件**: 用户已登录，存在可报名的期次

**测试步骤**:
1. 打开首页，点击某个期次
2. 点击"立即报名"按钮
3. 填写报名表单（11 个字段）
4. 点击"提交报名"
5. 验证弹窗显示成功
6. 返回首页，检查状态是否变为"已报名"

**预期结果**:
- ✅ 表单验证工作正常
- ✅ 报名数据保存到后端
- ✅ 报名状态实时更新
- ✅ 前端本地缓存更新

**关键检查点**:
- [ ] 必填字段验证
- [ ] 条件字段验证（读过书籍选项）
- [ ] 字数限制验证
- [ ] API 调用成功
- [ ] 错误提示准确

**实际结果**:
- 状态: 待验证

---

#### 场景 2.2: 支付流程
**前置条件**: 用户已报名

**测试步骤**:
1. 报名后自动跳转到支付页面
2. 验证订单信息显示正确
3. 选择支付方式（模拟支付）
4. 点击"确认支付"
5. 验证支付成功提示
6. 验证状态更新为"已支付"

**预期结果**:
- ✅ 订单信息准确
- ✅ 支付确认成功
- ✅ 枚举记录状态更新
- ✅ 可进入课程列表

**关键检查点**:
- [ ] 订单金额正确
- [ ] 支付方式选择工作
- [ ] 模拟支付逻辑正确
- [ ] 支付状态同步到报名记录

**实际结果**:
- 状态: 待验证

---

### 3. 课程和打卡功能测试

#### 场景 3.1: 查看课程列表
**前置条件**: 用户已支付报名费

**测试步骤**:
1. 点击晨读营菜单
2. 查看期次列表
3. 点击某个期次进入课程列表
4. 验证课程列表显示
5. 查看打卡记录

**预期结果**:
- ✅ 期次列表正确显示
- ✅ 课程信息准确
- ✅ 打卡状态显示正确
- ✅ 可以查看他人打卡

**关键检查点**:
- [ ] 数据库数据一致
- [ ] 打卡统计准确
- [ ] 时间格式化正确
- [ ] 用户头像颜色稳定

**实际结果**:
- 状态: 待验证

---

#### 场景 3.2: 打卡流程
**前置条件**: 用户在课程详情页

**测试步骤**:
1. 点击"打卡"按钮
2. 填写打卡内容
3. 上传图片（可选）
4. 点击"提交打卡"
5. 验证打卡成功
6. 返回课程页，检查打卡状态

**预期结果**:
- ✅ 打卡表单显示
- ✅ 内容保存成功
- ✅ 图片上传成功
- ✅ 打卡记录在列表中显示
- ✅ 日历状态更新

**关键检查点**:
- [ ] 图片上传工作
- [ ] 内容保存到后端
- [ ] 日期关联正确
- [ ] 数据同步及时

**实际结果**:
- 状态: 待验证

---

### 4. 管理后台功能测试

#### 场景 4.1: 期次管理
**前置条件**: 管理员已登录

**测试步骤**:
1. 点击左侧"期次管理"菜单
2. 查看期次列表
3. 点击"新建期次"按钮
4. 填写期次表单
5. 点击"保存"
6. 验证期次是否添加到列表
7. 编辑和删除期次

**预期结果**:
- ✅ 列表加载成功
- ✅ 表单验证工作
- ✅ 新增期次成功
- ✅ 编辑功能正常
- ✅ 删除功能安全

**关键检查点**:
- [ ] 表单字段验证
- [ ] 日期选择器工作
- [ ] 颜色选择器工作
- [ ] 删除前检查报名
- [ ] 发布/下架切换

**实际结果**:
- 状态: 待验证

---

#### 场景 4.2: 内容管理
**前置条件**: 至少存在一个期次

**测试步骤**:
1. 点击左侧"内容管理"菜单
2. 选择期次
3. 编辑各个标签页的内容
   - 简介：输入文字和上传图片
   - 学习内容：编辑 5 个学习模块
   - FAQ：添加问答对
   - 媒体：上传文件
4. 分别保存各标签
5. 刷新页面，验证内容是否保存

**预期结果**:
- ✅ 富文本编辑器工作
- ✅ 图片上传成功
- ✅ 文件上传成功
- ✅ 内容保存到数据库
- ✅ 页面刷新后数据恢复

**关键检查点**:
- [ ] 图片上传和插入
- [ ] 文件上传功能
- [ ] 富文本保存格式
- [ ] 模块动态添加/删除
- [ ] 数据持久化

**实际结果**:
- 状态: 待验证

---

#### 场景 4.3: 数据分析
**前置条件**: 后端有足够的测试数据

**测试步骤**:
1. 点击左侧"数据分析"菜单
2. 查看关键指标卡片
3. 修改日期范围
4. 点击"查询"刷新数据
5. 查看期次统计表格
6. 查看用户行为统计
7. 查看 7 天趋势图

**预期结果**:
- ✅ 指标卡片显示
- ✅ 日期选择器工作
- ✅ 数据过滤正确
- ✅ 表格数据准确
- ✅ 图表渲染正确

**关键检查点**:
- [ ] 数据准确性
- [ ] 日期范围过滤
- [ ] 统计计算正确
- [ ] 图表显示完整
- [ ] 性能不卡顿

**实际结果**:
- 状态: 待验证

---

### 5. 文件上传系统测试

#### 场景 5.1: 图片上传（在编辑器中）
**前置条件**: 在内容管理的某个编辑器中

**测试步骤**:
1. 点击编辑器工具栏的"图片"按钮
2. 选择一张图片文件
3. 验证上传进度
4. 验证图片自动插入到编辑器
5. 保存内容
6. 刷新页面，验证图片链接有效

**预期结果**:
- ✅ 文件选择对话框打开
- ✅ 上传成功提示
- ✅ Markdown 链接自动插入
- ✅ 图片在编辑器中显示
- ✅ 保存后链接仍然有效

**边界测试**:
- [ ] 超大图片（>10MB）被拒绝
- [ ] 非图片文件被拒绝
- [ ] 网络中断后重试

**实际结果**:
- 状态: 待验证

---

#### 场景 5.2: 媒体文件上传
**前置条件**: 在内容管理的媒体标签页

**测试步骤**:
1. 在媒体资源标签页
2. 拖拽或点击上传文件
3. 验证文件显示在列表中
4. 点击删除按钮
5. 保存媒体内容
6. 刷新页面验证

**预期结果**:
- ✅ 文件上传成功
- ✅ 文件列表显示
- ✅ 删除功能正常
- ✅ 保存后文件持久化
- ✅ 显示文件信息（名称、大小）

**边界测试**:
- [ ] 不支持的文件类型
- [ ] 极端文件大小
- [ ] 多文件同时上传

**实际结果**:
- 状态: 待验证

---

### 6. API 集成测试

#### 场景 6.1: 报名 API
**端点**: `POST /api/v1/enrollments`

**测试用例**:

```bash
# 1. 正常报名
curl -X POST http://localhost:3000/api/v1/enrollments \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user123",
    "periodId": "period123",
    "name": "张三",
    "gender": "male",
    "province": "北京市",
    "detailedAddress": "朝阳区某街道",
    "age": 28,
    ...
  }'

# 预期: 201 Created
# 响应: { code: 200, data: { enrollmentId, status: "pending" } }

# 2. 缺少必填字段
curl -X POST http://localhost:3000/api/v1/enrollments \
  -H "Content-Type: application/json" \
  -d '{ "userId": "user123" }'

# 预期: 400 Bad Request
# 响应: 字段验证错误提示
```

**预期结果**:
- ✅ 正常报名返回 201
- ✅ 验证错误返回 400
- ✅ 重复报名被检查
- ✅ 报名数据正确保存
- ✅ 期次人数更新

**关键检查点**:
- [ ] 输入验证完整
- [ ] 错误消息清晰
- [ ] 数据库事务正确
- [ ] 并发报名处理

**实际结果**:
- 状态: 待验证

---

#### 场景 6.2: 上传 API
**端点**: `POST /api/v1/upload`

**测试用例**:

```bash
# 1. 上传图片
curl -X POST http://localhost:3000/api/v1/upload \
  -H "Authorization: Bearer <admin-token>" \
  -F "file=@image.jpg"

# 预期: 200 OK
# 响应: { code: 200, data: { filename, url, size } }

# 2. 上传非图片文件（错误）
curl -X POST http://localhost:3000/api/v1/upload \
  -H "Authorization: Bearer <admin-token>" \
  -F "file=@document.exe"

# 预期: 400 Bad Request
# 响应: 文件类型不支持
```

**预期结果**:
- ✅ 文件上传成功返回 URL
- ✅ 不支持的文件类型被拒绝
- ✅ 文件大小检查工作
- ✅ 生成唯一文件名
- ✅ 文件可访问

**关键检查点**:
- [ ] 文件类型白名单
- [ ] 大小限制生效
- [ ] 路径安全
- [ ] JWT 认证

**实际结果**:
- 状态: 待验证

---

## 🔒 安全测试

### 1. 认证和授权
- [ ] 未登录用户无法访问受保护路由
- [ ] Token 过期后需要重新登录
- [ ] 无效 Token 被拒绝
- [ ] 普通用户无法访问管理后台
- [ ] 权限检查正确

### 2. 数据验证
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] CSRF 防护
- [ ] 文件上传安全
  - [ ] 不能绕过文件类型检查
  - [ ] 不能上传到任意目录
  - [ ] 不能执行上传的文件

### 3. API 安全
- [ ] 速率限制（防 DDoS）
- [ ] 输入长度限制
- [ ] HTTPS 只有
- [ ] CORS 正确配置

---

## ⚡ 性能测试

### 1. 加载性能
- [ ] 首页加载时间 < 2 秒
- [ ] 管理后台加载时间 < 3 秒
- [ ] 列表查询响应 < 1 秒
- [ ] 图片加载不阻塞 UI

### 2. 数据库性能
- [ ] 报名查询（1000+ 条）< 500ms
- [ ] 统计查询 < 1 秒
- [ ] 批量操作支持

### 3. 并发测试
- [ ] 同时 100 个用户登录
- [ ] 同时 50 个报名请求
- [ ] 同时 20 个上传请求

---

## 📱 兼容性测试

### 小程序
- [ ] iOS 微信客户端
- [ ] Android 微信客户端
- [ ] 基础库 >= 2.10.0

### 管理后台
- [ ] Chrome 最新版
- [ ] Safari 最新版
- [ ] Firefox 最新版
- [ ] Edge 最新版
- [ ] 1920x1080 分辨率
- [ ] 1366x768 分辨率
- [ ] 移动设备（平板）

---

## 🐛 已知问题

### 需要跟进的问题

| 问题 | 优先级 | 状态 | 备注 |
|------|--------|------|------|
| 图片上传超时 | 中 | 待修复 | 大文件需要优化 |
| 移动端菜单溢出 | 低 | 待修复 | 小屏幕显示问题 |
| 富文本编辑器光标 | 低 | 待修复 | 某些情况下位置不准 |

---

## 📊 测试执行结果

### 总体概览

| 项目 | 总数 | 通过 | 失败 | 待测 |
|------|------|------|------|------|
| 功能测试 | 25 | 0 | 0 | 25 |
| 集成测试 | 12 | 0 | 0 | 12 |
| 安全测试 | 15 | 0 | 0 | 15 |
| 性能测试 | 8 | 0 | 0 | 8 |
| 兼容性测试 | 10 | 0 | 0 | 10 |
| **合计** | **70** | **0** | **0** | **70** |

### 执行日期

- 开始日期: 待执行
- 预计完成: 待执行
- 实际完成: 待执行

---

## ✅ 测试通过标准

项目认为通过的条件：

1. **功能测试**: ≥ 90% 通过
2. **集成测试**: ≥ 95% 通过
3. **安全测试**: 100% 通过（关键项）
4. **性能测试**: ≥ 80% 通过
5. **兼容性测试**: ≥ 90% 通过

---

## 📝 测试报告模板

每个测试执行后，按以下格式记录：

```markdown
### 测试: [测试名称]
**执行日期**: YYYY-MM-DD
**执行人**:
**结果**: PASS / FAIL

**详细记录**:
- 步骤1: 预期结果 / 实际结果
- 步骤2: 预期结果 / 实际结果

**备注**:
- 问题描述（如有）
- 后续跟进（如需要）
```

---

## 🚀 发布前检查清单

发布前必须完成的检查：

- [ ] 所有功能测试通过
- [ ] 没有 P0 级 bug
- [ ] 安全审查通过
- [ ] 性能指标达标
- [ ] 文档完整
- [ ] 环境配置正确
- [ ] 备份和恢复流程测试
- [ ] 用户文档准备

---

**测试负责人**: QA Team
**最后更新**: 2025-11-21
**下次审查**: 每个版本发布前
