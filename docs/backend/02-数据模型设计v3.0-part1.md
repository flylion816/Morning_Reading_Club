# æ•°æ®æ¨¡å‹è®¾è®¡ v3.0

## æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç‰ˆæœ¬**: v3.0
- **äº§å“ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-13
- **æ–‡æ¡£çŠ¶æ€**: å·²å‘å¸ƒ

## è¯´æ˜

æœ¬æ–‡æ¡£åŸºäºå‰ç«¯v1.0å®é™…ä»£ç ä¸­çš„æ‰€æœ‰Mockæ•°æ®å’Œé¡µé¢dataç»“æ„ï¼Œè¯¦ç»†å®šä¹‰äº†æ‰€æœ‰æ•°æ®å®ä½“å’Œå­—æ®µã€‚

---

## ä¸€ã€å®ä½“æ¦‚è§ˆ

### 1.1 æ ¸å¿ƒå®ä½“åˆ—è¡¨

| åºå· | å®ä½“åç§° | è‹±æ–‡åç§° | è¯´æ˜ |
|------|---------|---------|------|
| 1 | ç”¨æˆ· | User | ç³»ç»Ÿç”¨æˆ·åŸºæœ¬ä¿¡æ¯ |
| 2 | æœŸæ¬¡ | Period | æ™¨è¯»è¥æœŸæ¬¡ |
| 3 | è¯¾èŠ‚ | Section | æ¯å¤©çš„å­¦ä¹ è¯¾èŠ‚ |
| 4 | æ‰“å¡ | Checkin | ç”¨æˆ·æ‰“å¡è®°å½• |
| 5 | è¯„è®º | Comment | å¯¹æ‰“å¡çš„è¯„è®º |
| 6 | å›å¤ | Reply | å¯¹è¯„è®ºçš„å›å¤ |
| 7 | å°å‡¡çœ‹è§ | Insight | AIç”Ÿæˆçš„åé¦ˆ |
| 8 | æŸ¥çœ‹ç”³è¯· | InsightRequest | æŸ¥çœ‹ä»–äººå°å‡¡çœ‹è§çš„ç”³è¯· |
| 9 | æŠ¥åè®°å½• | Enrollment | ç”¨æˆ·æŠ¥åæœŸæ¬¡è®°å½• |
| 10 | æ–‡ä»¶ | File | ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘ï¼‰ |

### 1.2 å®ä½“å…³ç³»å›¾ï¼ˆæ–‡å­—æè¿°ï¼‰

```
User (ç”¨æˆ·)
  â”œâ”€â”€ 1:N â†’ Enrollment (æŠ¥åè®°å½•)
  â”œâ”€â”€ 1:N â†’ Checkin (æ‰“å¡)
  â”œâ”€â”€ 1:N â†’ Comment (è¯„è®º)
  â”œâ”€â”€ 1:N â†’ Reply (å›å¤)
  â”œâ”€â”€ 1:N â†’ Insight (å°å‡¡çœ‹è§)
  â””â”€â”€ 1:N â†’ InsightRequest (æŸ¥çœ‹ç”³è¯·)

Period (æœŸæ¬¡)
  â”œâ”€â”€ 1:N â†’ Section (è¯¾èŠ‚)
  â”œâ”€â”€ 1:N â†’ Enrollment (æŠ¥åè®°å½•)
  â””â”€â”€ 1:N â†’ Checkin (æ‰“å¡)

Section (è¯¾èŠ‚)
  â”œâ”€â”€ N:1 â†’ Period (æœŸæ¬¡)
  â”œâ”€â”€ 1:N â†’ Checkin (æ‰“å¡)
  â””â”€â”€ 1:N â†’ Insight (å°å‡¡çœ‹è§)

Checkin (æ‰“å¡)
  â”œâ”€â”€ N:1 â†’ User (ç”¨æˆ·)
  â”œâ”€â”€ N:1 â†’ Section (è¯¾èŠ‚)
  â”œâ”€â”€ 1:N â†’ Comment (è¯„è®º)
  â”œâ”€â”€ 1:N â†’ File (æ–‡ä»¶)
  â””â”€â”€ 1:1 â†’ Insight (å°å‡¡çœ‹è§)

Comment (è¯„è®º)
  â”œâ”€â”€ N:1 â†’ User (ç”¨æˆ·)
  â”œâ”€â”€ N:1 â†’ Checkin (æ‰“å¡)
  â””â”€â”€ 1:N â†’ Reply (å›å¤)

Insight (å°å‡¡çœ‹è§)
  â”œâ”€â”€ N:1 â†’ User (ç”¨æˆ·)
  â”œâ”€â”€ N:1 â†’ Checkin (æ‰“å¡)
  â””â”€â”€ 1:N â†’ InsightRequest (æŸ¥çœ‹ç”³è¯·)
```

---

## äºŒã€è¯¦ç»†å®ä½“å®šä¹‰

### 2.1 User (ç”¨æˆ·)

**è¡¨å**: `users`

**è¯´æ˜**: å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ | 1 |
| openid | String | 64 | æ˜¯ | - | å¾®ä¿¡OpenIDï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ | o6_bmjrPTlm6_2sgVt7hMZOPfL2M |
| unionid | String | 64 | å¦ | null | å¾®ä¿¡UnionID | oTmHYjg-tElZ9uUkEW7aZr |
| nickname | String | 50 | æ˜¯ | - | ç”¨æˆ·æ˜µç§° | é˜¿æ³° |
| avatar | String | 10 | å¦ | ğŸ¦ | å¤´åƒemoji | ğŸ¦ æˆ– æ³° |
| avatarUrl | String | 500 | å¦ | null | å¾®ä¿¡å¤´åƒURL | https://... |
| signature | String | 200 | å¦ | null | ä¸ªæ€§ç­¾å | å¤©å¤©å¼€å¿ƒï¼Œè§‰çŸ¥å½“ä¸‹ï¼ |
| gender | Enum | - | å¦ | unknown | æ€§åˆ« | male/female/unknown |
| country | String | 50 | å¦ | null | å›½å®¶ | ä¸­å›½ |
| province | String | 50 | å¦ | null | çœä»½ | å¹¿ä¸œ |
| city | String | 50 | å¦ | null | åŸå¸‚ | æ·±åœ³ |
| language | String | 20 | å¦ | zh_CN | è¯­è¨€ | zh_CN |
| totalCheckinDays | Integer | - | å¦ | 0 | ç´¯è®¡æ‰“å¡å¤©æ•° | 23 |
| currentStreak | Integer | - | å¦ | 0 | å½“å‰è¿ç»­æ‰“å¡å¤©æ•° | 5 |
| maxStreak | Integer | - | å¦ | 0 | æœ€é•¿è¿ç»­æ‰“å¡å¤©æ•° | 15 |
| totalCompletedPeriods | Integer | - | å¦ | 0 | å®Œæˆçš„æœŸæ•° | 3 |
| totalPoints | Integer | - | å¦ | 0 | æ€»ç§¯åˆ† | 500 |
| level | Integer | - | å¦ | 1 | ç”¨æˆ·ç­‰çº§ | 1 |
| role | Enum | - | å¦ | user | è§’è‰² | user/admin |
| status | Enum | - | å¦ | active | çŠ¶æ€ | active/banned/deleted |
| lastLoginAt | DateTime | - | å¦ | null | æœ€åç™»å½•æ—¶é—´ | 2025-01-13 10:30:00 |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-01-10 08:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-01-13 10:30:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- UNIQUE INDEX: openid
- INDEX: unionid
- INDEX: nickname
- INDEX: createdAt

**æšä¸¾ç±»å‹**:

```javascript
// æ€§åˆ«
Gender = {
  MALE: 'male',
  FEMALE: 'female',
  UNKNOWN: 'unknown'
}

// è§’è‰²
Role = {
  USER: 'user',
  ADMIN: 'admin',
  SUPER_ADMIN: 'super_admin'
}

// çŠ¶æ€
UserStatus = {
  ACTIVE: 'active',
  BANNED: 'banned',
  DELETED: 'deleted'
}
```

**éªŒè¯è§„åˆ™**:
- nickname: 2-50å­—ç¬¦
- signature: 0-200å­—ç¬¦
- avatar: 1-10å­—ç¬¦ï¼ˆemojiï¼‰
- avatarUrl: æœ‰æ•ˆURLæ ¼å¼

---

### 2.2 Period (æœŸæ¬¡)

**è¡¨å**: `periods`

**è¯´æ˜**: æ™¨è¯»è¥æœŸæ¬¡ä¿¡æ¯ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | æœŸæ¬¡IDï¼ˆä¸»é”®ï¼‰ | 8 |
| name | String | 50 | æ˜¯ | - | æœŸæ¬¡åç§° | å‹‡æ•¢çš„å¿ƒ |
| subtitle | String | 100 | å¦ | null | å‰¯æ ‡é¢˜ | ä¸ƒä¸ªä¹ æƒ¯æ™¨è¯»è¥ |
| title | String | 100 | æ˜¯ | - | å®Œæ•´æ ‡é¢˜ | å‹‡æ•¢çš„å¿ƒ - ä¸ƒä¸ªä¹ æƒ¯æ™¨è¯»è¥ |
| description | Text | - | å¦ | null | æœŸæ¬¡ä»‹ç» | 21å¤©å…»æˆé˜…è¯»ä¹ æƒ¯... |
| icon | String | 10 | å¦ | ğŸ“š | å›¾æ ‡emoji | â›°ï¸ |
| coverColor | String | 100 | å¦ | null | å°é¢é¢œè‰²ï¼ˆCSSæ¸å˜ï¼‰ | linear-gradient(...) |
| coverEmoji | String | 10 | å¦ | ğŸ“– | å°é¢emoji | ğŸ”ï¸ |
| startDate | Date | - | æ˜¯ | - | å¼€å§‹æ—¥æœŸ | 2025-10-11 |
| endDate | Date | - | æ˜¯ | - | ç»“æŸæ—¥æœŸ | 2025-11-13 |
| totalDays | Integer | - | å¦ | 23 | æ€»å¤©æ•° | 23 |
| price | Decimal | 10,2 | å¦ | 0.00 | ä»·æ ¼ï¼ˆå…ƒï¼‰ | 99.00 |
| originalPrice | Decimal | 10,2 | å¦ | 0.00 | åŸä»· | 199.00 |
| maxEnrollment | Integer | - | å¦ | null | æœ€å¤§æŠ¥åäººæ•° | 500 |
| currentEnrollment | Integer | - | å¦ | 0 | å½“å‰æŠ¥åäººæ•° | 235 |
| status | Enum | - | å¦ | not_started | çŠ¶æ€ | not_started/ongoing/completed |
| isPublished | Boolean | - | å¦ | false | æ˜¯å¦å‘å¸ƒ | true |
| sortOrder | Integer | - | å¦ | 0 | æ’åºæƒé‡ | 100 |
| createdBy | Integer | - | å¦ | null | åˆ›å»ºäººID | 1 |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-01-01 00:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-01-10 00:00:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- INDEX: startDate, endDate
- INDEX: status
- INDEX: isPublished, sortOrder

**æšä¸¾ç±»å‹**:

```javascript
PeriodStatus = {
  NOT_STARTED: 'not_started',  // æœªå¼€å§‹
  ONGOING: 'ongoing',           // è¿›è¡Œä¸­
  COMPLETED: 'completed'        // å·²ç»“æŸ
}
```

**è®¡ç®—å­—æ®µ** (å‰ç«¯è®¡ç®—æˆ–APIè¿”å›):
- `dateRange`: "10-11 è‡³ 11-13" (ä»startDateå’ŒendDateè®¡ç®—)
- `progress`: 0-100 (å®Œæˆè¿›åº¦ç™¾åˆ†æ¯”)
- `isEnrolled`: true/false (å½“å‰ç”¨æˆ·æ˜¯å¦å·²æŠ¥å)
- `checkedDays`: 0-23 (å½“å‰ç”¨æˆ·æ‰“å¡å¤©æ•°)

---

### 2.3 Section (è¯¾èŠ‚)

**è¡¨å**: `sections`

**è¯´æ˜**: æ¯å¤©çš„å­¦ä¹ è¯¾èŠ‚å†…å®¹ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | è¯¾èŠ‚IDï¼ˆä¸»é”®ï¼‰ | 802 |
| periodId | Integer | - | æ˜¯ | - | æ‰€å±æœŸæ¬¡IDï¼ˆå¤–é”®ï¼‰ | 8 |
| day | Integer | - | æ˜¯ | - | ç¬¬å‡ å¤©ï¼ˆ0=å¼€è¥è¯ï¼‰ | 1 |
| title | String | 100 | æ˜¯ | - | è¯¾èŠ‚æ ‡é¢˜ | ç¬¬ä¸€å¤© å“å¾·æˆåŠŸè®º |
| subtitle | String | 200 | å¦ | null | å‰¯æ ‡é¢˜ | äº†è§£å“å¾·çš„é‡è¦æ€§ |
| coverColor | String | 100 | å¦ | null | å°é¢é¢œè‰² | #4a90e2 |
| coverEmoji | String | 10 | å¦ | ğŸ“– | å°é¢emoji | ğŸ”ï¸ |
| startTime | DateTime | - | æ˜¯ | - | æ‰“å¡å¼€å§‹æ—¶é—´ | 2025-10-11 06:59:00 |
| endTime | DateTime | - | æ˜¯ | - | æ‰“å¡ç»“æŸæ—¶é—´ | 2025-10-13 06:59:59 |
| meditation | Text | - | å¦ | null | é™ä¸€é™å†…å®¹ | å¼€å§‹å­¦ä¹ ä¹‹å‰... |
| question | Text | - | å¦ | null | é—®ä¸€é—®å†…å®¹ | å“å¾·æˆåŠŸè®ºå’Œä¸ªæ€§... |
| content | Text | - | æ˜¯ | - | è¯»ä¸€è¯»å†…å®¹ï¼ˆå¯Œæ–‡æœ¬ï¼‰ | <p>çºµè§‚å†å²...</p> |
| reflection | Text | - | å¦ | null | æƒ³ä¸€æƒ³å†…å®¹ | å“ªä¸€å¥è¯è§¦åŠ¨æˆ‘... |
| action | Text | - | å¦ | null | è®°ä¸€è®°å†…å®¹ | æŠŠæ„Ÿè§¦è®°å½•... |
| sortOrder | Integer | - | å¦ | 0 | æ’åº | 1 |
| isPublished | Boolean | - | å¦ | false | æ˜¯å¦å‘å¸ƒ | true |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-01-01 00:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-01-10 00:00:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- INDEX: periodId, day
- INDEX: periodId, sortOrder
- INDEX: startTime, endTime

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (periodId) REFERENCES periods(id) ON DELETE CASCADE

**è®¡ç®—å­—æ®µ**:
- `checkinCount`: å½“å‰è¯¾èŠ‚æ‰“å¡äººæ•°
- `isCheckedIn`: å½“å‰ç”¨æˆ·æ˜¯å¦å·²æ‰“å¡
- `dateRange`: "10-11 è‡³ 10-13"

---

### 2.4 Checkin (æ‰“å¡)

**è¡¨å**: `checkins`

**è¯´æ˜**: ç”¨æˆ·æ¯å¤©çš„æ‰“å¡è®°å½•ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | æ‰“å¡IDï¼ˆä¸»é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| periodId | Integer | - | æ˜¯ | - | æœŸæ¬¡IDï¼ˆå¤–é”®ï¼‰ | 8 |
| sectionId | Integer | - | æ˜¯ | - | è¯¾èŠ‚IDï¼ˆå¤–é”®ï¼‰ | 802 |
| content | Text | - | æ˜¯ | - | æ‰“å¡å†…å®¹ | ä»Šå¤©å­¦ä¹ äº†å“å¾·æˆåŠŸè®º... |
| visibility | Enum | - | å¦ | all | å¯è§èŒƒå›´ | all/admin_only |
| likeCount | Integer | - | å¦ | 0 | ç‚¹èµæ•° | 5 |
| commentCount | Integer | - | å¦ | 0 | è¯„è®ºæ•° | 3 |
| isLiked | Boolean | - | å¦ | false | å½“å‰ç”¨æˆ·æ˜¯å¦ç‚¹èµ | true |
| status | Enum | - | å¦ | normal | çŠ¶æ€ | normal/deleted/hidden |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 07:30:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 07:30:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- UNIQUE INDEX: userId, sectionId (ä¸€ä¸ªç”¨æˆ·æ¯ä¸ªè¯¾èŠ‚åªèƒ½æ‰“å¡ä¸€æ¬¡)
- INDEX: periodId, createdAt DESC (æœŸæ¬¡æ‰“å¡åˆ—è¡¨)
- INDEX: sectionId, createdAt DESC (è¯¾èŠ‚æ‰“å¡åˆ—è¡¨)
- INDEX: userId, createdAt DESC (ç”¨æˆ·æ‰“å¡åˆ—è¡¨)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (periodId) REFERENCES periods(id) ON DELETE CASCADE
- FOREIGN KEY (sectionId) REFERENCES sections(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
CheckinVisibility = {
  ALL: 'all',               // æ‰€æœ‰äººå¯è§
  ADMIN_ONLY: 'admin_only'  // ä»…ç®¡ç†å‘˜å¯è§
}

CheckinStatus = {
  NORMAL: 'normal',   // æ­£å¸¸
  DELETED: 'deleted', // å·²åˆ é™¤
  HIDDEN: 'hidden'    // å·²éšè—
}
```

**å…³è”æ•°æ®**:
- images: String[] - å›¾ç‰‡URLæ•°ç»„
- videos: String[] - è§†é¢‘URLæ•°ç»„
- voices: String[] - éŸ³é¢‘URLæ•°ç»„

**è®¡ç®—å­—æ®µ**:
- `userName`: ç”¨æˆ·æ˜µç§°
- `avatarText`: ç”¨æˆ·å¤´åƒæ–‡å­—
- `avatarColor`: ç”¨æˆ·å¤´åƒé¢œè‰²
- `sectionTitle`: è¯¾èŠ‚æ ‡é¢˜
- `sectionDay`: è¯¾èŠ‚å¤©æ•°
- `createTimeFormatted`: æ ¼å¼åŒ–çš„åˆ›å»ºæ—¶é—´ï¼ˆå¦‚"1å°æ—¶å‰"ï¼‰

---

### 2.5 Comment (è¯„è®º)

**è¡¨å**: `comments`

**è¯´æ˜**: å¯¹æ‰“å¡çš„è¯„è®ºã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | è¯„è®ºIDï¼ˆä¸»é”®ï¼‰ | 1 |
| checkinId | Integer | - | æ˜¯ | - | æ‰“å¡IDï¼ˆå¤–é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | è¯„è®ºç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| content | Text | - | æ˜¯ | - | è¯„è®ºå†…å®¹ | å†™å¾—å¾ˆå¥½ï¼ |
| likeCount | Integer | - | å¦ | 0 | ç‚¹èµæ•° | 3 |
| replyCount | Integer | - | å¦ | 0 | å›å¤æ•° | 2 |
| isLiked | Boolean | - | å¦ | false | å½“å‰ç”¨æˆ·æ˜¯å¦ç‚¹èµ | true |
| status | Enum | - | å¦ | normal | çŠ¶æ€ | normal/deleted |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 08:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 08:00:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- INDEX: checkinId, createdAt DESC (æ‰“å¡è¯„è®ºåˆ—è¡¨)
- INDEX: userId, createdAt DESC (ç”¨æˆ·è¯„è®ºåˆ—è¡¨)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (checkinId) REFERENCES checkins(id) ON DELETE CASCADE
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
CommentStatus = {
  NORMAL: 'normal',   // æ­£å¸¸
  DELETED: 'deleted'  // å·²åˆ é™¤
}
```

**è®¡ç®—å­—æ®µ**:
- `userName`: è¯„è®ºç”¨æˆ·æ˜µç§°
- `avatarText`: è¯„è®ºç”¨æˆ·å¤´åƒæ–‡å­—
- `avatarColor`: è¯„è®ºç”¨æˆ·å¤´åƒé¢œè‰²
- `createTimeFormatted`: æ ¼å¼åŒ–çš„åˆ›å»ºæ—¶é—´ï¼ˆå¦‚"1å°æ—¶å‰"ï¼‰

---

### 2.6 Reply (å›å¤)

**è¡¨å**: `replies`

**è¯´æ˜**: å¯¹è¯„è®ºçš„å›å¤ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | å›å¤IDï¼ˆä¸»é”®ï¼‰ | 1 |
| commentId | Integer | - | æ˜¯ | - | è¯„è®ºIDï¼ˆå¤–é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | å›å¤ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| toUserId | Integer | - | å¦ | null | è¢«å›å¤ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 102 |
| content | Text | - | æ˜¯ | - | å›å¤å†…å®¹ | è°¢è°¢ä½ çš„é¼“åŠ±ï¼ |
| likeCount | Integer | - | å¦ | 0 | ç‚¹èµæ•° | 1 |
| isLiked | Boolean | - | å¦ | false | å½“å‰ç”¨æˆ·æ˜¯å¦ç‚¹èµ | false |
| status | Enum | - | å¦ | normal | çŠ¶æ€ | normal/deleted |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 08:30:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 08:30:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- INDEX: commentId, createdAt ASC (è¯„è®ºå›å¤åˆ—è¡¨)
- INDEX: userId, createdAt DESC (ç”¨æˆ·å›å¤åˆ—è¡¨)
- INDEX: toUserId, createdAt DESC (è¢«å›å¤ç”¨æˆ·åˆ—è¡¨)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (commentId) REFERENCES comments(id) ON DELETE CASCADE
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (toUserId) REFERENCES users(id) ON DELETE SET NULL

**æšä¸¾ç±»å‹**:

```javascript
ReplyStatus = {
  NORMAL: 'normal',   // æ­£å¸¸
  DELETED: 'deleted'  // å·²åˆ é™¤
}
```

**è®¡ç®—å­—æ®µ**:
- `userName`: å›å¤ç”¨æˆ·æ˜µç§°
- `avatarText`: å›å¤ç”¨æˆ·å¤´åƒæ–‡å­—
- `avatarColor`: å›å¤ç”¨æˆ·å¤´åƒé¢œè‰²
- `toUserName`: è¢«å›å¤ç”¨æˆ·æ˜µç§°ï¼ˆå¦‚æœæœ‰ï¼‰
- `createTimeFormatted`: æ ¼å¼åŒ–çš„åˆ›å»ºæ—¶é—´

---

### 2.7 Insight (å°å‡¡çœ‹è§)

**è¡¨å**: `insights`

**è¯´æ˜**: AIç”Ÿæˆçš„ä¸ªæ€§åŒ–åé¦ˆå†…å®¹ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | å°å‡¡çœ‹è§IDï¼ˆä¸»é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| checkinId | Integer | - | æ˜¯ | - | æ‰“å¡IDï¼ˆå¤–é”®ï¼‰ | 1 |
| sectionId | Integer | - | æ˜¯ | - | è¯¾èŠ‚IDï¼ˆå¤–é”®ï¼‰ | 802 |
| content | Text | - | æ˜¯ | - | AIç”Ÿæˆçš„å†…å®¹ | ä»ä½ çš„åˆ†äº«ä¸­... |
| visibility | Enum | - | å¦ | private | å¯è§èŒƒå›´ | private/friends/public |
| viewCount | Integer | - | å¦ | 0 | æŸ¥çœ‹æ¬¡æ•° | 5 |
| requestCount | Integer | - | å¦ | 0 | ç”³è¯·æŸ¥çœ‹æ¬¡æ•° | 2 |
| aiModel | String | 50 | å¦ | null | AIæ¨¡å‹ç‰ˆæœ¬ | gpt-4 |
| generatedAt | DateTime | - | æ˜¯ | now() | ç”Ÿæˆæ—¶é—´ | 2025-10-11 08:00:00 |
| status | Enum | - | å¦ | normal | çŠ¶æ€ | normal/deleted |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 08:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 08:00:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- UNIQUE INDEX: checkinId (æ¯ä¸ªæ‰“å¡åªæœ‰ä¸€ä¸ªå°å‡¡çœ‹è§)
- INDEX: userId, createdAt DESC (ç”¨æˆ·å°å‡¡çœ‹è§åˆ—è¡¨)
- INDEX: sectionId, createdAt DESC (è¯¾èŠ‚å°å‡¡çœ‹è§åˆ—è¡¨)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (checkinId) REFERENCES checkins(id) ON DELETE CASCADE
- FOREIGN KEY (sectionId) REFERENCES sections(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
InsightVisibility = {
  PRIVATE: 'private',   // ä»…è‡ªå·±å¯è§
  FRIENDS: 'friends',   // æœ‹å‹å¯è§ï¼ˆéœ€è¦ç”³è¯·ï¼‰
  PUBLIC: 'public'      // æ‰€æœ‰äººå¯è§
}

InsightStatus = {
  NORMAL: 'normal',     // æ­£å¸¸
  DELETED: 'deleted'    // å·²åˆ é™¤
}
```

**è®¡ç®—å­—æ®µ**:
- `sectionTitle`: è¯¾èŠ‚æ ‡é¢˜
- `sectionDay`: è¯¾èŠ‚å¤©æ•°
- `preview`: å†…å®¹é¢„è§ˆï¼ˆå‰50å­—ç¬¦ï¼‰

---

### 2.8 InsightRequest (æŸ¥çœ‹ç”³è¯·)

**è¡¨å**: `insight_requests`

**è¯´æ˜**: ç”¨æˆ·ç”³è¯·æŸ¥çœ‹ä»–äººå°å‡¡çœ‹è§çš„è®°å½•ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | ç”³è¯·IDï¼ˆä¸»é”®ï¼‰ | 1 |
| insightId | Integer | - | æ˜¯ | - | å°å‡¡çœ‹è§IDï¼ˆå¤–é”®ï¼‰ | 1 |
| fromUserId | Integer | - | æ˜¯ | - | ç”³è¯·äººIDï¼ˆå¤–é”®ï¼‰ | 102 |
| toUserId | Integer | - | æ˜¯ | - | è¢«ç”³è¯·äººIDï¼ˆå¤–é”®ï¼‰ | 101 |
| status | Enum | - | å¦ | pending | ç”³è¯·çŠ¶æ€ | pending/approved/rejected |
| message | String | 200 | å¦ | null | ç”³è¯·ç•™è¨€ | æƒ³çœ‹çœ‹ä½ çš„æ„Ÿæ‚Ÿ |
| replyMessage | String | 200 | å¦ | null | å›å¤ç•™è¨€ | å¥½çš„ï¼ŒåŒæ„ |
| processedAt | DateTime | - | å¦ | null | å¤„ç†æ—¶é—´ | 2025-10-11 09:00:00 |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 08:30:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 09:00:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- UNIQUE INDEX: insightId, fromUserId (åŒä¸€ä¸ªå°å‡¡çœ‹è§ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½ç”³è¯·ä¸€æ¬¡)
- INDEX: toUserId, status, createdAt DESC (æ”¶åˆ°çš„ç”³è¯·åˆ—è¡¨)
- INDEX: fromUserId, status, createdAt DESC (å‘å‡ºçš„ç”³è¯·åˆ—è¡¨)
- INDEX: insightId (å°å‡¡çœ‹è§çš„ç”³è¯·åˆ—è¡¨)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (insightId) REFERENCES insights(id) ON DELETE CASCADE
- FOREIGN KEY (fromUserId) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (toUserId) REFERENCES users(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
RequestStatus = {
  PENDING: 'pending',     // å¾…å¤„ç†
  APPROVED: 'approved',   // å·²åŒæ„
  REJECTED: 'rejected'    // å·²æ‹’ç»
}
```

**è®¡ç®—å­—æ®µ**:
- `fromUserName`: ç”³è¯·äººæ˜µç§°
- `fromUserAvatar`: ç”³è¯·äººå¤´åƒ
- `toUserName`: è¢«ç”³è¯·äººæ˜µç§°
- `createTimeFormatted`: æ ¼å¼åŒ–çš„ç”³è¯·æ—¶é—´ï¼ˆå¦‚"2å°æ—¶å‰"ï¼‰

---

### 2.9 Enrollment (æŠ¥åè®°å½•)

**è¡¨å**: `enrollments`

**è¯´æ˜**: ç”¨æˆ·æŠ¥åæœŸæ¬¡çš„è®°å½•ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | æŠ¥åIDï¼ˆä¸»é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| periodId | Integer | - | æ˜¯ | - | æœŸæ¬¡IDï¼ˆå¤–é”®ï¼‰ | 8 |
| status | Enum | - | å¦ | active | çŠ¶æ€ | active/completed/cancelled |
| checkinDays | Integer | - | å¦ | 0 | æ‰“å¡å¤©æ•° | 15 |
| totalDays | Integer | - | å¦ | 23 | æ€»å¤©æ•° | 23 |
| progress | Integer | - | å¦ | 0 | å®Œæˆè¿›åº¦ï¼ˆç™¾åˆ†æ¯”ï¼‰ | 65 |
| lastCheckinAt | DateTime | - | å¦ | null | æœ€åæ‰“å¡æ—¶é—´ | 2025-10-15 07:30:00 |
| completedAt | DateTime | - | å¦ | null | å®Œæˆæ—¶é—´ | null |
| cancelledAt | DateTime | - | å¦ | null | å–æ¶ˆæ—¶é—´ | null |
| paymentStatus | Enum | - | å¦ | unpaid | æ”¯ä»˜çŠ¶æ€ | unpaid/paid/refunded |
| paymentAmount | Decimal | 10,2 | å¦ | 0.00 | æ”¯ä»˜é‡‘é¢ | 99.00 |
| paymentAt | DateTime | - | å¦ | null | æ”¯ä»˜æ—¶é—´ | 2025-10-10 10:00:00 |
| orderNo | String | 64 | å¦ | null | è®¢å•å· | ORDER20251010... |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-10 10:00:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-15 07:30:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- UNIQUE INDEX: userId, periodId (æ¯ä¸ªç”¨æˆ·æ¯ä¸ªæœŸæ¬¡åªèƒ½æŠ¥åä¸€æ¬¡)
- INDEX: userId, status, createdAt DESC (ç”¨æˆ·æŠ¥ååˆ—è¡¨)
- INDEX: periodId, status, createdAt DESC (æœŸæ¬¡æŠ¥ååˆ—è¡¨)
- INDEX: orderNo (è®¢å•å·æŸ¥è¯¢)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE
- FOREIGN KEY (periodId) REFERENCES periods(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
EnrollmentStatus = {
  ACTIVE: 'active',       // è¿›è¡Œä¸­
  COMPLETED: 'completed', // å·²å®Œæˆ
  CANCELLED: 'cancelled'  // å·²å–æ¶ˆ
}

PaymentStatus = {
  UNPAID: 'unpaid',       // æœªæ”¯ä»˜
  PAID: 'paid',           // å·²æ”¯ä»˜
  REFUNDED: 'refunded'    // å·²é€€æ¬¾
}
```

**è®¡ç®—å­—æ®µ**:
- `periodName`: æœŸæ¬¡åç§°
- `periodStartDate`: æœŸæ¬¡å¼€å§‹æ—¥æœŸ
- `periodEndDate`: æœŸæ¬¡ç»“æŸæ—¥æœŸ
- `isCompleted`: æ˜¯å¦å·²å®Œæˆï¼ˆprogress >= 100ï¼‰

---

### 2.10 File (æ–‡ä»¶)

**è¡¨å**: `files`

**è¯´æ˜**: ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘ï¼‰ã€‚

**å­—æ®µåˆ—è¡¨**:

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|--------|------|------|
| id | Integer | - | æ˜¯ | è‡ªå¢ | æ–‡ä»¶IDï¼ˆä¸»é”®ï¼‰ | 1 |
| userId | Integer | - | æ˜¯ | - | ä¸Šä¼ ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | 101 |
| relatedType | Enum | - | æ˜¯ | - | å…³è”ç±»å‹ | checkin/comment/reply |
| relatedId | Integer | - | æ˜¯ | - | å…³è”ID | 1 |
| fileType | Enum | - | æ˜¯ | - | æ–‡ä»¶ç±»å‹ | image/video/audio |
| originalName | String | 255 | æ˜¯ | - | åŸå§‹æ–‡ä»¶å | photo.jpg |
| fileName | String | 255 | æ˜¯ | - | å­˜å‚¨æ–‡ä»¶å | 20251011_xxxxx.jpg |
| fileUrl | String | 500 | æ˜¯ | - | æ–‡ä»¶URL | https://cos.xxx.com/... |
| fileSize | Integer | - | æ˜¯ | - | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | 1024000 |
| mimeType | String | 100 | æ˜¯ | - | MIMEç±»å‹ | image/jpeg |
| width | Integer | - | å¦ | null | å®½åº¦ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰ | 1920 |
| height | Integer | - | å¦ | null | é«˜åº¦ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰ | 1080 |
| duration | Integer | - | å¦ | null | æ—¶é•¿ï¼ˆè§†é¢‘/éŸ³é¢‘ï¼Œç§’ï¼‰ | 120 |
| thumbnailUrl | String | 500 | å¦ | null | ç¼©ç•¥å›¾URL | https://cos.xxx.com/... |
| status | Enum | - | å¦ | normal | çŠ¶æ€ | normal/deleted |
| createdAt | DateTime | - | æ˜¯ | now() | åˆ›å»ºæ—¶é—´ | 2025-10-11 07:30:00 |
| updatedAt | DateTime | - | æ˜¯ | now() | æ›´æ–°æ—¶é—´ | 2025-10-11 07:30:00 |

**ç´¢å¼•**:
- PRIMARY KEY: id
- INDEX: userId, createdAt DESC (ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨)
- INDEX: relatedType, relatedId (å…³è”æ–‡ä»¶åˆ—è¡¨)
- INDEX: fileType, createdAt DESC (æŒ‰ç±»å‹æŸ¥è¯¢)

**å¤–é”®çº¦æŸ**:
- FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE

**æšä¸¾ç±»å‹**:

```javascript
RelatedType = {
  CHECKIN: 'checkin',   // æ‰“å¡
  COMMENT: 'comment',   // è¯„è®º
  REPLY: 'reply'        // å›å¤
}

FileType = {
  IMAGE: 'image',       // å›¾ç‰‡
  VIDEO: 'video',       // è§†é¢‘
  AUDIO: 'audio'        // éŸ³é¢‘
}

FileStatus = {
  NORMAL: 'normal',     // æ­£å¸¸
  DELETED: 'deleted'    // å·²åˆ é™¤
}
```

**éªŒè¯è§„åˆ™**:
- å›¾ç‰‡ï¼šæ”¯æŒjpgã€jpegã€pngã€gifã€webpï¼Œæœ€å¤§10MB
- è§†é¢‘ï¼šæ”¯æŒmp4ã€movï¼Œæœ€å¤§100MB
- éŸ³é¢‘ï¼šæ”¯æŒmp3ã€m4aã€wavï¼Œæœ€å¤§20MB

**è®¡ç®—å­—æ®µ**:
- `fileSizeFormatted`: æ ¼å¼åŒ–çš„æ–‡ä»¶å¤§å°ï¼ˆå¦‚"1.5MB"ï¼‰
- `durationFormatted`: æ ¼å¼åŒ–çš„æ—¶é•¿ï¼ˆå¦‚"02:30"ï¼‰

---

## ä¸‰ã€æ•°æ®å…³ç³»è¯¦è§£

### 3.1 ä¸€å¯¹å¤šå…³ç³» (1:N)

**User â†’ Enrollment**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥æŠ¥åå¤šä¸ªæœŸæ¬¡
- é€šè¿‡ `enrollments.userId` å…³è”

**User â†’ Checkin**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªæ‰“å¡è®°å½•
- é€šè¿‡ `checkins.userId` å…³è”

**User â†’ Comment**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘è¡¨å¤šæ¡è¯„è®º
- é€šè¿‡ `comments.userId` å…³è”

**User â†’ Reply**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘è¡¨å¤šæ¡å›å¤
- é€šè¿‡ `replies.userId` å…³è”

**User â†’ Insight**
- ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªå°å‡¡çœ‹è§
- é€šè¿‡ `insights.userId` å…³è”

**Period â†’ Section**
- ä¸€ä¸ªæœŸæ¬¡åŒ…å«å¤šä¸ªè¯¾èŠ‚
- é€šè¿‡ `sections.periodId` å…³è”

**Period â†’ Enrollment**
- ä¸€ä¸ªæœŸæ¬¡å¯ä»¥æœ‰å¤šä¸ªæŠ¥åè®°å½•
- é€šè¿‡ `enrollments.periodId` å…³è”

**Section â†’ Checkin**
- ä¸€ä¸ªè¯¾èŠ‚å¯ä»¥æœ‰å¤šä¸ªæ‰“å¡è®°å½•
- é€šè¿‡ `checkins.sectionId` å…³è”

**Checkin â†’ Comment**
- ä¸€ä¸ªæ‰“å¡å¯ä»¥æœ‰å¤šæ¡è¯„è®º
- é€šè¿‡ `comments.checkinId` å…³è”

**Checkin â†’ File**
- ä¸€ä¸ªæ‰“å¡å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ï¼ˆå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘ï¼‰
- é€šè¿‡ `files.relatedId` (relatedType='checkin') å…³è”

**Comment â†’ Reply**
- ä¸€æ¡è¯„è®ºå¯ä»¥æœ‰å¤šæ¡å›å¤
- é€šè¿‡ `replies.commentId` å…³è”

**Insight â†’ InsightRequest**
- ä¸€ä¸ªå°å‡¡çœ‹è§å¯ä»¥æœ‰å¤šä¸ªæŸ¥çœ‹ç”³è¯·
- é€šè¿‡ `insight_requests.insightId` å…³è”

### 3.2 ä¸€å¯¹ä¸€å…³ç³» (1:1)

**Checkin â†” Insight**
- ä¸€ä¸ªæ‰“å¡å¯¹åº”ä¸€ä¸ªå°å‡¡çœ‹è§
- é€šè¿‡ `insights.checkinId` (UNIQUE) å…³è”

### 3.3 å¤šå¯¹å¤šå…³ç³»

**ç”¨æˆ·ç‚¹èµæ‰“å¡** (é€šè¿‡ä¸­é—´è¡¨ `checkin_likes`)
- å­—æ®µï¼šid, userId, checkinId, createdAt
- å”¯ä¸€ç´¢å¼•ï¼š(userId, checkinId)

**ç”¨æˆ·ç‚¹èµè¯„è®º** (é€šè¿‡ä¸­é—´è¡¨ `comment_likes`)
- å­—æ®µï¼šid, userId, commentId, createdAt
- å”¯ä¸€ç´¢å¼•ï¼š(userId, commentId)

**ç”¨æˆ·ç‚¹èµå›å¤** (é€šè¿‡ä¸­é—´è¡¨ `reply_likes`)
- å­—æ®µï¼šid, userId, replyId, createdAt
- å”¯ä¸€ç´¢å¼•ï¼š(userId, replyId)

---

## å››ã€ä¸šåŠ¡è§„åˆ™å’Œçº¦æŸ

### 4.1 å”¯ä¸€æ€§çº¦æŸ

1. **ç”¨æˆ·ç»´åº¦**
   - `users.openid`: å¾®ä¿¡OpenIDå…¨å±€å”¯ä¸€
   - `enrollments(userId, periodId)`: æ¯ä¸ªç”¨æˆ·æ¯ä¸ªæœŸæ¬¡åªèƒ½æŠ¥åä¸€æ¬¡
   - `checkins(userId, sectionId)`: æ¯ä¸ªç”¨æˆ·æ¯ä¸ªè¯¾èŠ‚åªèƒ½æ‰“å¡ä¸€æ¬¡
   - `insight_requests(insightId, fromUserId)`: åŒä¸€ä¸ªå°å‡¡çœ‹è§æ¯ä¸ªç”¨æˆ·åªèƒ½ç”³è¯·ä¸€æ¬¡

2. **æ•°æ®ç»´åº¦**
   - `insights.checkinId`: æ¯ä¸ªæ‰“å¡åªæœ‰ä¸€ä¸ªå°å‡¡çœ‹è§

### 4.2 çº§è”åˆ é™¤è§„åˆ™

1. **ç”¨æˆ·åˆ é™¤**
   - åˆ é™¤ç”¨æˆ·æ—¶ï¼Œçº§è”åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰ï¼šæŠ¥åè®°å½•ã€æ‰“å¡ã€è¯„è®ºã€å›å¤ã€å°å‡¡çœ‹è§ã€æ–‡ä»¶

2. **æœŸæ¬¡åˆ é™¤**
   - åˆ é™¤æœŸæ¬¡æ—¶ï¼Œçº§è”åˆ é™¤è¯¥æœŸæ¬¡çš„æ‰€æœ‰ï¼šè¯¾èŠ‚ã€æŠ¥åè®°å½•ã€æ‰“å¡

3. **è¯¾èŠ‚åˆ é™¤**
   - åˆ é™¤è¯¾èŠ‚æ—¶ï¼Œçº§è”åˆ é™¤è¯¥è¯¾èŠ‚çš„æ‰€æœ‰æ‰“å¡

4. **æ‰“å¡åˆ é™¤**
   - åˆ é™¤æ‰“å¡æ—¶ï¼Œçº§è”åˆ é™¤è¯¥æ‰“å¡çš„æ‰€æœ‰ï¼šè¯„è®ºã€æ–‡ä»¶ã€å°å‡¡çœ‹è§

5. **è¯„è®ºåˆ é™¤**
   - åˆ é™¤è¯„è®ºæ—¶ï¼Œçº§è”åˆ é™¤è¯¥è¯„è®ºçš„æ‰€æœ‰å›å¤

6. **å°å‡¡çœ‹è§åˆ é™¤**
   - åˆ é™¤å°å‡¡çœ‹è§æ—¶ï¼Œçº§è”åˆ é™¤æ‰€æœ‰æŸ¥çœ‹ç”³è¯·

### 4.3 è½¯åˆ é™¤å­—æ®µ

ä»¥ä¸‹å®ä½“æ”¯æŒè½¯åˆ é™¤ï¼ˆé€šè¿‡statuså­—æ®µæ ‡è®°ä¸ºdeletedï¼‰ï¼š
- User
- Checkin
- Comment
- Reply
- Insight
- File

### 4.4 è®¡æ•°å™¨å­—æ®µåŒæ­¥è§„åˆ™

1. **æ‰“å¡ç‚¹èµæ•°** (`checkins.likeCount`)
   - æ–°å¢ç‚¹èµï¼š+1
   - å–æ¶ˆç‚¹èµï¼š-1

2. **æ‰“å¡è¯„è®ºæ•°** (`checkins.commentCount`)
   - æ–°å¢è¯„è®ºï¼š+1
   - åˆ é™¤è¯„è®ºï¼š-1

3. **è¯„è®ºå›å¤æ•°** (`comments.replyCount`)
   - æ–°å¢å›å¤ï¼š+1
   - åˆ é™¤å›å¤ï¼š-1

4. **å°å‡¡çœ‹è§æŸ¥çœ‹æ¬¡æ•°** (`insights.viewCount`)
   - æ¯æ¬¡æŸ¥çœ‹ï¼š+1

5. **å°å‡¡çœ‹è§ç”³è¯·æ¬¡æ•°** (`insights.requestCount`)
   - æ–°å¢ç”³è¯·ï¼š+1

6. **ç”¨æˆ·æ‰“å¡ç»Ÿè®¡**
   - `users.totalCheckinDays`: ç´¯è®¡æ‰“å¡å¤©æ•°ï¼ˆæ–°å¢æ‰“å¡æ—¶+1ï¼‰
   - `users.currentStreak`: å½“å‰è¿ç»­æ‰“å¡å¤©æ•°ï¼ˆè¿ç»­æ‰“å¡æ—¶+1ï¼Œä¸­æ–­æ—¶é‡ç½®ä¸º1ï¼‰
   - `users.maxStreak`: æœ€é•¿è¿ç»­æ‰“å¡å¤©æ•°ï¼ˆå½“currentStreak > maxStreakæ—¶æ›´æ–°ï¼‰

7. **æœŸæ¬¡æŠ¥åäººæ•°** (`periods.currentEnrollment`)
   - æ–°å¢æŠ¥åï¼š+1
   - å–æ¶ˆæŠ¥åï¼š-1

---

## äº”ã€å­—æ®µå‘½åè§„èŒƒ

### 5.1 é€šç”¨å­—æ®µ

æ‰€æœ‰è¡¨éƒ½åŒ…å«ï¼š
- `id`: ä¸»é”®ï¼Œè‡ªå¢æ•´æ•°
- `createdAt`: åˆ›å»ºæ—¶é—´
- `updatedAt`: æ›´æ–°æ—¶é—´

### 5.2 å¤–é”®å­—æ®µ

- å‘½åæ ¼å¼ï¼š`{å®ä½“å}Id`ï¼ˆé©¼å³°å‘½åï¼‰
- ç¤ºä¾‹ï¼šuserId, periodId, sectionId, checkinId

### 5.3 çŠ¶æ€å­—æ®µ

- `status`: å®ä½“çŠ¶æ€ï¼ˆactive/deletedç­‰ï¼‰
- `isXxx`: å¸ƒå°”æ ‡å¿—ï¼ˆisPublished, isLikedç­‰ï¼‰

### 5.4 è®¡æ•°å™¨å­—æ®µ

- å‘½åæ ¼å¼ï¼š`xxxCount`
- ç¤ºä¾‹ï¼šlikeCount, commentCount, replyCount

### 5.5 æ—¶é—´å­—æ®µ

- åˆ›å»ºæ—¶é—´ï¼š`createdAt`
- æ›´æ–°æ—¶é—´ï¼š`updatedAt`
- æœ€åæ“ä½œæ—¶é—´ï¼š`lastXxxAt`ï¼ˆlastLoginAt, lastCheckinAtï¼‰
- å®Œæˆæ—¶é—´ï¼š`xxxedAt`ï¼ˆcompletedAt, processedAtï¼‰

---

## å…­ã€æ•°æ®ç±»å‹è¯´æ˜

### 6.1 MySQLæ•°æ®ç±»å‹æ˜ å°„

| é€»è¾‘ç±»å‹ | MySQLç±»å‹ | è¯´æ˜ |
|---------|----------|------|
| Integer | INT | æ•´æ•° |
| String | VARCHAR(n) | å¯å˜é•¿å­—ç¬¦ä¸² |
| Text | TEXT | é•¿æ–‡æœ¬ |
| Boolean | TINYINT(1) | å¸ƒå°”å€¼ï¼ˆ0/1ï¼‰ |
| Enum | VARCHAR(20) | æšä¸¾å€¼ |
| Date | DATE | æ—¥æœŸ |
| DateTime | DATETIME | æ—¥æœŸæ—¶é—´ |
| Decimal | DECIMAL(m,n) | ç²¾ç¡®å°æ•° |

### 6.2 MongoDBæ•°æ®ç±»å‹æ˜ å°„

| é€»è¾‘ç±»å‹ | MongoDBç±»å‹ | Mongooseç±»å‹ |
|---------|-------------|-------------|
| Integer | Number | Number |
| String | String | String |
| Text | String | String |
| Boolean | Boolean | Boolean |
| Enum | String | String (enum) |
| Date | Date | Date |
| DateTime | Date | Date |
| Decimal | Number/Decimal128 | Number |

---

## ä¸ƒã€ç´¢å¼•è®¾è®¡åŸåˆ™

### 7.1 ä¸»é”®ç´¢å¼•

- æ‰€æœ‰è¡¨çš„ `id` å­—æ®µä½œä¸ºä¸»é”®
- è‡ªåŠ¨åˆ›å»ºèšç°‡ç´¢å¼•ï¼ˆMySQL InnoDBï¼‰

### 7.2 å”¯ä¸€ç´¢å¼•

ç”¨äºä¿è¯ä¸šåŠ¡å”¯ä¸€æ€§ï¼š
- `users.openid`
- `enrollments(userId, periodId)`
- `checkins(userId, sectionId)`
- `insights.checkinId`
- `insight_requests(insightId, fromUserId)`

### 7.3 å¤–é”®ç´¢å¼•

ç”¨äºå…³è”æŸ¥è¯¢å’Œçº§è”æ“ä½œï¼š
- æ‰€æœ‰å¤–é”®å­—æ®µï¼ˆuserId, periodId, sectionIdç­‰ï¼‰

### 7.4 å¤åˆç´¢å¼•

ç”¨äºä¼˜åŒ–åˆ—è¡¨æŸ¥è¯¢ï¼š
- `(periodId, createdAt DESC)`: æœŸæ¬¡ç›¸å…³çš„æ—¶é—´åºåˆ—æŸ¥è¯¢
- `(userId, createdAt DESC)`: ç”¨æˆ·ç›¸å…³çš„æ—¶é—´åºåˆ—æŸ¥è¯¢
- `(sectionId, createdAt DESC)`: è¯¾èŠ‚ç›¸å…³çš„æ—¶é—´åºåˆ—æŸ¥è¯¢
- `(isPublished, sortOrder)`: å‘å¸ƒå†…å®¹çš„æ’åºæŸ¥è¯¢

### 7.5 ç´¢å¼•ä¼˜åŒ–å»ºè®®

1. **é€‰æ‹©æ€§é«˜çš„å­—æ®µä¼˜å…ˆå»ºç´¢å¼•**
2. **å¸¸ç”¨äºWHEREã€ORDER BYçš„å­—æ®µå»ºç´¢å¼•**
3. **å¤–é”®å­—æ®µå¿…é¡»å»ºç´¢å¼•**
4. **é¿å…è¿‡å¤šç´¢å¼•å½±å“å†™å…¥æ€§èƒ½**
5. **å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œåˆ é™¤æ— ç”¨ç´¢å¼•**

---

## å…«ã€æ•°æ®è¿ç§»å’Œåˆå§‹åŒ–

### 8.1 åˆå§‹æ•°æ®

**ç®¡ç†å‘˜è´¦å·**:
```json
{
  "openid": "ADMIN_OPENID",
  "nickname": "ç®¡ç†å‘˜",
  "avatar": "ğŸ‘¨â€ğŸ’¼",
  "role": "admin",
  "status": "active"
}
```

**ç¤ºä¾‹æœŸæ¬¡æ•°æ®**:
- å‚è€ƒ `miniprogram/mock/courses.js` ä¸­çš„ `periods` æ•°ç»„
- éœ€è¦å¯¼å…¥8ä¸ªæœŸæ¬¡çš„å®Œæ•´æ•°æ®

**ç¤ºä¾‹è¯¾èŠ‚æ•°æ®**:
- å‚è€ƒ `miniprogram/mock/courses.js` ä¸­çš„ `sections` å¯¹è±¡
- æ¯ä¸ªæœŸæ¬¡23-24ä¸ªè¯¾èŠ‚ï¼ˆå«ç¬¬0å¤©å¼€è¥è¯ï¼‰

### 8.2 æ•°æ®è¿ç§»ç­–ç•¥

ä»å‰ç«¯æœ¬åœ°å­˜å‚¨è¿ç§»åˆ°åç«¯æ•°æ®åº“ï¼š

1. **ç”¨æˆ·æ•°æ®**
   - ä¿ç•™å¾®ä¿¡ç™»å½•çš„openid
   - è¿ç§»ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®

2. **æ‰“å¡æ•°æ®**
   - è¿ç§»æ‰€æœ‰å†å²æ‰“å¡è®°å½•
   - å…³è”åˆ°å¯¹åº”çš„è¯¾èŠ‚å’ŒæœŸæ¬¡

3. **äº¤äº’æ•°æ®**
   - è¿ç§»è¯„è®ºå’Œå›å¤æ•°æ®
   - é‡æ–°è®¡ç®—ç‚¹èµæ•°å’Œå›å¤æ•°

4. **æ–‡ä»¶æ•°æ®**
   - è¿ç§»æœ¬åœ°å›¾ç‰‡åˆ°äº‘å­˜å‚¨
   - æ›´æ–°æ–‡ä»¶URLå¼•ç”¨

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 9.1 æ•°æ®åº“ä¼˜åŒ–

1. **åˆç†ä½¿ç”¨ç´¢å¼•**
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
   - é¿å…è¿‡å¤šç´¢å¼•

2. **è¯»å†™åˆ†ç¦»**
   - é…ç½®ä¸»ä»å¤åˆ¶
   - è¯»æ“ä½œèµ°ä»åº“

3. **åˆ†åº“åˆ†è¡¨**
   - æŒ‰æœŸæ¬¡åˆ†è¡¨ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
   - æŒ‰æ—¶é—´åˆ†è¡¨ï¼ˆå¦‚æ‰“å¡è®°å½•æŒ‰å¹´æœˆåˆ†è¡¨ï¼‰

### 9.2 ç¼“å­˜ç­–ç•¥

1. **çƒ­ç‚¹æ•°æ®ç¼“å­˜**
   - æœŸæ¬¡åˆ—è¡¨ï¼ˆ15åˆ†é’Ÿï¼‰
   - è¯¾èŠ‚å†…å®¹ï¼ˆ30åˆ†é’Ÿï¼‰
   - ç”¨æˆ·ä¿¡æ¯ï¼ˆ5åˆ†é’Ÿï¼‰

2. **è®¡æ•°å™¨ç¼“å­˜**
   - ç‚¹èµæ•°ã€è¯„è®ºæ•°ä½¿ç”¨Redisè®¡æ•°å™¨
   - å®šæœŸåŒæ­¥åˆ°æ•°æ®åº“

3. **æŸ¥è¯¢ç»“æœç¼“å­˜**
   - æ’è¡Œæ¦œï¼ˆ1åˆ†é’Ÿï¼‰
   - æ‰“å¡åˆ—è¡¨ï¼ˆ30ç§’ï¼‰

### 9.3 æŸ¥è¯¢ä¼˜åŒ–

1. **ä½¿ç”¨åˆ†é¡µ**
   - æ‰€æœ‰åˆ—è¡¨æ¥å£å¿…é¡»åˆ†é¡µ
   - é»˜è®¤æ¯é¡µ20æ¡

2. **é¿å…N+1æŸ¥è¯¢**
   - ä½¿ç”¨JOINæˆ–æ‰¹é‡æŸ¥è¯¢
   - å‡å°‘æ•°æ®åº“å¾€è¿”æ¬¡æ•°

3. **åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ**
   - é¿å…SELECT *
   - ä½¿ç”¨å­—æ®µæŠ•å½±

---

## åã€æ•°æ®å®‰å…¨å’Œéšç§

### 10.1 æ•æ„Ÿæ•°æ®å¤„ç†

1. **å¾®ä¿¡OpenID**
   - ä¸å¯¹å¤–æš´éœ²
   - ä»…ç”¨äºå†…éƒ¨å…³è”

2. **ç”¨æˆ·åœ°ç†ä½ç½®**
   - country, province, city
   - ä»…ç®¡ç†å‘˜å¯è§å®Œæ•´ä¿¡æ¯

3. **å°å‡¡çœ‹è§å†…å®¹**
   - é»˜è®¤ç§æœ‰
   - éœ€è¦ç”³è¯·æ‰èƒ½æŸ¥çœ‹

### 10.2 æ•°æ®è®¿é—®æ§åˆ¶

1. **ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®**
   - æ‰“å¡è®°å½•
   - å°å‡¡çœ‹è§
   - æŠ¥åè®°å½•

2. **ç®¡ç†å‘˜æƒé™**
   - å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®
   - å¯ä»¥ç®¡ç†æ‰€æœ‰å†…å®¹

3. **éšç§è®¾ç½®**
   - æ‰“å¡å¯è§æ€§ï¼šall/admin_only
   - å°å‡¡çœ‹è§å¯è§æ€§ï¼šprivate/friends/public

### 10.3 æ•°æ®å¤‡ä»½

1. **å®šæœŸå¤‡ä»½**
   - æ¯å¤©å…¨é‡å¤‡ä»½
   - æ¯å°æ—¶å¢é‡å¤‡ä»½

2. **å¤‡ä»½ä¿ç•™**
   - å…¨é‡å¤‡ä»½ä¿ç•™30å¤©
   - å¢é‡å¤‡ä»½ä¿ç•™7å¤©

3. **ç¾éš¾æ¢å¤**
   - RPOï¼ˆæ¢å¤ç‚¹ç›®æ ‡ï¼‰ï¼š1å°æ—¶
   - RTOï¼ˆæ¢å¤æ—¶é—´ç›®æ ‡ï¼‰ï¼š4å°æ—¶

---

## é™„å½•Aï¼šMockæ•°æ®ç¤ºä¾‹

### A.1 Period Mockæ•°æ®

```javascript
{
  id: 8,
  name: 'å‹‡æ•¢çš„å¿ƒ',
  subtitle: 'ä¸ƒä¸ªä¹ æƒ¯æ™¨è¯»è¥',
  title: 'å‹‡æ•¢çš„å¿ƒ - ä¸ƒä¸ªä¹ æƒ¯æ™¨è¯»è¥',
  icon: 'â›°ï¸',
  color: 'linear-gradient(135deg, #4a90e2 0%, #357abd 100%)',
  startDate: '2025/10/11',
  endDate: '2025/11/13',
  totalDays: 23,
  status: 'ongoing',
  currentEnrollment: 235,
  isEnrolled: true,
  checkedDays: 15,
  progress: 65
}
```

### A.2 Section Mockæ•°æ®

```javascript
{
  id: 802,
  periodId: 8,
  day: 1,
  title: 'ç¬¬ä¸€å¤© å“å¾·æˆåŠŸè®º',
  subtitle: 'äº†è§£å“å¾·çš„é‡è¦æ€§',
  coverColor: '#4a90e2',
  coverEmoji: 'ğŸ”ï¸',
  startTime: '2025/10/11 06:59:00',
  endTime: '2025/10/13 06:59:59',
  checkinCount: 15,
  isCheckedIn: false
}
```

### A.3 Checkin Mockæ•°æ®

```javascript
{
  id: 1,
  userId: 101,
  sectionId: 802,
  content: 'ä»Šå¤©å­¦ä¹ äº†å“å¾·æˆåŠŸè®ºï¼Œæ·±æœ‰æ„Ÿè§¦...',
  images: ['https://...'],
  visibility: 'all',
  likeCount: 5,
  commentCount: 3,
  isLiked: false,
  userName: 'é˜¿æ³°',
  avatarText: 'æ³°',
  createTime: '07:30'
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0  
**æœ€åæ›´æ–°**: 2025-01-13  
**æ–‡æ¡£çŠ¶æ€**: å·²å®Œæˆ

